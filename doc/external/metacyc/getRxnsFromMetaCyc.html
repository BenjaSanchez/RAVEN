<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getRxnsFromMetaCyc</title>
  <meta name="keywords" content="getRxnsFromMetaCyc">
  <meta name="description" content="getRxnsFromMetaCyc">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">external</a> &gt; <a href="index.html">metacyc</a> &gt; getRxnsFromMetaCyc.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for external\metacyc&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>getRxnsFromMetaCyc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>getRxnsFromMetaCyc</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> getRxnsFromMetaCyc
   Retrieves reactions information from MetaCyc database

   Input:
   metacycPath         if metaCycRxns.mat is not in the RAVEN\external\metacyc
                       directory, this function will attempt to build it by
                       reading info from a local dump of MetaCyc database,
                       metacycPath is the path to the MetaCyc data files
   keepTransportRxns   include transportation reactions, which often have identical
                       reactants and products that turn to be all-zero columns in
                       the S matrix (opt, default false)
   keepUnbalanced      include reactions cannot be unbalanced reactions, usually
                       because they are polymeric reactions or because of a
                       specific difficulty in balancing class structures
                       (opt, default false)
   keepUndetermined    include reactions that have substrates lack chemical
                       structures or with non-numerical coefficients (e.g. n+1)
                       (opt, default false)

   Output:
   model     a model structure generated from the database. The following
             fields are filled
             id:             'MetaCyc'
             description:    'Automatically generated from MetaCyc database'
             rxns:           MetaCyc reaction ids
             rxnNames:       Name for each reaction entry
             mets:           MetaCyc compound ids. If the equations use
                             stoichiometry such as ID(n+1) then the whole
                             expression is saved as the id
             pwys:           MetaCyc pathway id
             eccodes:        Corresponding ec-number if available
             rxnMiriams:     Contains reaction specific information such as
                             associated RHEA and KEGG reaction ids
             S:              Stoichiometric matrix
             lb:             -1000 for all reactions
             ub:             1000 for all reactions
             rev:            1 for reversible and 0 for irreversible. For
                             reactions present in pathway maps the reversibility
                             is taken from there
             b:              0 for all metabolites
             version:        MetaCyc database version

   If the file metaCycRxns.mat is in the RAVEN/external/metacyc directory, it
   will be directly loaded instead of parsing the MetaCyc data files and
   pre-prepared lists of MetaCyc transport and undetermined reactions.

   Usage: model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)

   Hao Wang, 2018-11-01</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="getModelFromMetaCyc.html" class="code" title="function metaCycModel=getModelFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)">getModelFromMetaCyc</a>	getModelFromMetaCyc</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function newString=removeHTMLcodes(string)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)</a>
0002 <span class="comment">% getRxnsFromMetaCyc</span>
0003 <span class="comment">%   Retrieves reactions information from MetaCyc database</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   Input:</span>
0006 <span class="comment">%   metacycPath         if metaCycRxns.mat is not in the RAVEN\external\metacyc</span>
0007 <span class="comment">%                       directory, this function will attempt to build it by</span>
0008 <span class="comment">%                       reading info from a local dump of MetaCyc database,</span>
0009 <span class="comment">%                       metacycPath is the path to the MetaCyc data files</span>
0010 <span class="comment">%   keepTransportRxns   include transportation reactions, which often have identical</span>
0011 <span class="comment">%                       reactants and products that turn to be all-zero columns in</span>
0012 <span class="comment">%                       the S matrix (opt, default false)</span>
0013 <span class="comment">%   keepUnbalanced      include reactions cannot be unbalanced reactions, usually</span>
0014 <span class="comment">%                       because they are polymeric reactions or because of a</span>
0015 <span class="comment">%                       specific difficulty in balancing class structures</span>
0016 <span class="comment">%                       (opt, default false)</span>
0017 <span class="comment">%   keepUndetermined    include reactions that have substrates lack chemical</span>
0018 <span class="comment">%                       structures or with non-numerical coefficients (e.g. n+1)</span>
0019 <span class="comment">%                       (opt, default false)</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%   Output:</span>
0022 <span class="comment">%   model     a model structure generated from the database. The following</span>
0023 <span class="comment">%             fields are filled</span>
0024 <span class="comment">%             id:             'MetaCyc'</span>
0025 <span class="comment">%             description:    'Automatically generated from MetaCyc database'</span>
0026 <span class="comment">%             rxns:           MetaCyc reaction ids</span>
0027 <span class="comment">%             rxnNames:       Name for each reaction entry</span>
0028 <span class="comment">%             mets:           MetaCyc compound ids. If the equations use</span>
0029 <span class="comment">%                             stoichiometry such as ID(n+1) then the whole</span>
0030 <span class="comment">%                             expression is saved as the id</span>
0031 <span class="comment">%             pwys:           MetaCyc pathway id</span>
0032 <span class="comment">%             eccodes:        Corresponding ec-number if available</span>
0033 <span class="comment">%             rxnMiriams:     Contains reaction specific information such as</span>
0034 <span class="comment">%                             associated RHEA and KEGG reaction ids</span>
0035 <span class="comment">%             S:              Stoichiometric matrix</span>
0036 <span class="comment">%             lb:             -1000 for all reactions</span>
0037 <span class="comment">%             ub:             1000 for all reactions</span>
0038 <span class="comment">%             rev:            1 for reversible and 0 for irreversible. For</span>
0039 <span class="comment">%                             reactions present in pathway maps the reversibility</span>
0040 <span class="comment">%                             is taken from there</span>
0041 <span class="comment">%             b:              0 for all metabolites</span>
0042 <span class="comment">%             version:        MetaCyc database version</span>
0043 <span class="comment">%</span>
0044 <span class="comment">%   If the file metaCycRxns.mat is in the RAVEN/external/metacyc directory, it</span>
0045 <span class="comment">%   will be directly loaded instead of parsing the MetaCyc data files and</span>
0046 <span class="comment">%   pre-prepared lists of MetaCyc transport and undetermined reactions.</span>
0047 <span class="comment">%</span>
0048 <span class="comment">%   Usage: model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)</span>
0049 <span class="comment">%</span>
0050 <span class="comment">%   Hao Wang, 2018-11-01</span>
0051 <span class="comment">%</span>
0052 
0053 <span class="comment">%NOTE: This is how one entry looks in the file</span>
0054 
0055 <span class="comment">% UNIQUE-ID - 4-HYDROXY-2-KETOPIMELATE-LYSIS-RXN</span>
0056 <span class="comment">% TYPES - Small-Molecule-Reactions</span>
0057 <span class="comment">% TYPES - Chemical-Reactions</span>
0058 <span class="comment">% ATOM-MAPPINGS - (:NO-HYDROGEN-ENCODING (6 7 0 8 1 9 2 10 3 12 11 5 4) (((PYRUVATE 0 5) (SUCC-S-ALD 6 12)) ((CPD-804 0 12))))</span>
0059 <span class="comment">% DBLINKS - (LIGAND-RXN &quot;R01647&quot; NIL |kr| 3650824949 NIL NIL)</span>
0060 <span class="comment">% DBLINKS - (LIGAND-RXN &quot;R01645&quot; NIL |taltman| 3459474590 NIL NIL)</span>
0061 <span class="comment">% EC-NUMBER - EC-4.1.2.52</span>
0062 <span class="comment">% ^OFFICIAL? - T</span>
0063 <span class="comment">% ENZYMATIC-REACTION - ENZRXN-3009</span>
0064 <span class="comment">% IN-PATHWAY - 3-HYDROXYPHENYLACETATE-DEGRADATION-PWY</span>
0065 <span class="comment">% LEFT - CPD-804</span>
0066 <span class="comment">% ORPHAN? - :NO</span>
0067 <span class="comment">% PHYSIOLOGICALLY-RELEVANT? - T</span>
0068 <span class="comment">% REACTION-DIRECTION - LEFT-TO-RIGHT</span>
0069 <span class="comment">% RIGHT - SUCC-S-ALD</span>
0070 <span class="comment">% RIGHT - PYRUVATE</span>
0071 <span class="comment">% //</span>
0072 
0073 <span class="comment">% A line that contains only '//' separates each object.</span>
0074 
0075 <span class="keyword">if</span> nargin&lt;2
0076     keepTransportRxns=false;
0077 <span class="keyword">end</span>
0078 <span class="keyword">if</span> nargin&lt;3
0079     keepUnbalanced=false;
0080 <span class="keyword">end</span>
0081 <span class="keyword">if</span> nargin&lt;4
0082     keepUndetermined=false;
0083 <span class="keyword">end</span>
0084 
0085 <span class="comment">%Check if the reactions have been parsed before and saved. Directly load</span>
0086 <span class="comment">%the model if so.</span>
0087 [ST, I]=dbstack(<span class="string">'-completenames'</span>);
0088 ravenPath=fileparts(fileparts(fileparts(ST(I).file)));
0089 rxnsFile=fullfile(ravenPath,<span class="string">'external'</span>,<span class="string">'metacyc'</span>,<span class="string">'metaCycRxns.mat'</span>);
0090 metaCycRxnFile=<span class="string">'reactions.dat'</span>;
0091 metaCycPwyFile=<span class="string">'pathway-links.dat'</span>;
0092 
0093 <span class="keyword">if</span> exist(rxnsFile, <span class="string">'file'</span>)
0094     fprintf([<span class="string">'NOTE: Importing MetaCyc reactions from '</span> strrep(rxnsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">'.\n'</span>]);
0095     load(rxnsFile);
0096 <span class="keyword">else</span>
0097     fprintf([<span class="string">'Cannot locate '</span> strrep(rxnsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">'\nNow try to generate it from local MetaCyc data files...\n'</span>]);
0098     <span class="keyword">if</span> ~exist(fullfile(metacycPath,metaCycRxnFile),<span class="string">'file'</span>) || ~exist(fullfile(metacycPath,metaCycPwyFile),<span class="string">'file'</span>)
0099         EM=fprintf([<span class="string">'The files of reactions or pathways cannot be located, and should be downloaded from MetaCyc.\n'</span>]);
0100         dispEM(EM);
0101     <span class="keyword">else</span>
0102         metaCycRxns.id=<span class="string">'MetaCyc'</span>;
0103         metaCycRxns.description=<span class="string">'Automatically generated from MetaCyc database'</span>;
0104         
0105         <span class="comment">%Get pathway names and add them to the field of subSystems</span>
0106         fid = fopen(fullfile(metacycPath,metaCycPwyFile), <span class="string">'r'</span>);
0107         
0108         <span class="comment">%Keeps track of how many pathways that have been added</span>
0109         pwyCounter=0;
0110         pwys=cell(10000,1);
0111         pwyNames=cell(10000,1);
0112         
0113         <span class="comment">%Loop through the file</span>
0114         <span class="keyword">while</span> 1
0115             <span class="comment">%Get the next line</span>
0116             tline = fgetl(fid);
0117             
0118             <span class="comment">%Abort at end of file</span>
0119             <span class="keyword">if</span> ~ischar(tline)
0120                 <span class="keyword">break</span>;
0121             <span class="keyword">end</span>
0122             
0123             <span class="comment">%Read in pathway ids and names</span>
0124             <span class="keyword">if</span> ~strcmp(tline(1),<span class="string">'#'</span>)
0125                 pwyCounter=pwyCounter+1;
0126                 vars = regexp(tline, <span class="string">'\t'</span>, <span class="string">'split'</span>);
0127                 pwys{pwyCounter}=vars{1};
0128                 pwyNames{pwyCounter}=vars{2};
0129                 
0130                 <span class="comment">%Romve HTML symbols</span>
0131                 pwyNames{pwyCounter}=<a href="#_sub1" class="code" title="subfunction newString=removeHTMLcodes(string)">removeHTMLcodes</a>(pwyNames{pwyCounter});
0132                 
0133             <span class="keyword">end</span>
0134         <span class="keyword">end</span>
0135         fclose(fid);
0136         pwys=pwys(1:pwyCounter);
0137         pwyNames=pwyNames(1:pwyCounter);
0138         
0139         <span class="comment">%Preallocate memory for 50000 reactions</span>
0140         metaCycRxns.rxns=cell(50000,1);
0141         metaCycRxns.rxnNames=cell(50000,1);
0142         metaCycRxns.eccodes=cell(50000,1);
0143         metaCycRxns.subSystems=cell(50000,1);
0144         metaCycRxns.pwys=cell(50000,1);
0145         metaCycRxns.rxnMiriams=cell(50000,1);
0146         metaCycRxns.rxnReferences=cell(50000,1);
0147         metaCycRxns.rev=ones(50000,1); <span class="comment">%reversibility;</span>
0148         
0149         rxnLinks.metacyc=cell(10000,1);
0150         rxnLinks.kegg=cell(10000,1);
0151         rxnLinks.check=cell(10000,1);
0152         isSpontaneous=false(10000,1); <span class="comment">%spontaneous;</span>
0153         UNBALANCED=false(10000,1);
0154         UNDETERMINED=cell(10000,1);
0155         TRANSPORT=cell(10000,1);
0156         
0157         <span class="comment">%Transport reactions were organzied into a file</span>
0158         fid = fopen(fullfile(metacycPath,<span class="string">'transportRxns.txt'</span>), <span class="string">'r'</span>);
0159         transportCounter=0;
0160         <span class="comment">%Loop through the file</span>
0161         <span class="keyword">while</span> 1
0162             <span class="comment">%Get the next line</span>
0163             tline = fgetl(fid);
0164             
0165             <span class="comment">%Abort at end of file</span>
0166             <span class="keyword">if</span> ~ischar(tline)
0167                 <span class="keyword">break</span>;
0168             <span class="keyword">end</span>
0169             
0170             <span class="comment">%disp(tline);</span>
0171             transportCounter=transportCounter+1;
0172             TRANSPORT{transportCounter}=tline;
0173         <span class="keyword">end</span>
0174         <span class="comment">%Close the file</span>
0175         fclose(fid);
0176         TRANSPORT=TRANSPORT(1:transportCounter);
0177         
0178         <span class="comment">%Undetermined reactions were organzied into a file</span>
0179         fid = fopen(fullfile(metacycPath,<span class="string">'undeterminedRxns.txt'</span>), <span class="string">'r'</span>);
0180         undetermCounter=0;
0181         <span class="comment">%Loop through the file</span>
0182         <span class="keyword">while</span> 1
0183             <span class="comment">%Get the next line</span>
0184             tline = fgetl(fid);
0185             
0186             <span class="comment">%Abort at end of file</span>
0187             <span class="keyword">if</span> ~ischar(tline)
0188                 <span class="keyword">break</span>;
0189             <span class="keyword">end</span>
0190             
0191             <span class="comment">%disp(tline);</span>
0192             undetermCounter=undetermCounter+1;
0193             s=strfind(tline,<span class="string">': '</span>);
0194             <span class="keyword">if</span> s
0195                 UNDETERMINED{undetermCounter}=tline(1:s-1);
0196             <span class="keyword">end</span>
0197         <span class="keyword">end</span>
0198         <span class="comment">%Close the file</span>
0199         fclose(fid);
0200         UNDETERMINED=UNDETERMINED(1:undetermCounter);
0201         
0202         metaCycRxns.equations=cell(50000,1); <span class="comment">%reaction equations</span>
0203         left=cell(50000,1); <span class="comment">%Temporarily stores the equations</span>
0204         right=cell(50000,1); <span class="comment">%Temporarily stores the equations</span>
0205         
0206         <span class="comment">%First load information on reaction ID, reaction name,, pathway,</span>
0207         <span class="comment">%and ec-number</span>
0208         fid = fopen(fullfile(metacycPath,metaCycRxnFile), <span class="string">'r'</span>);
0209         
0210         <span class="comment">%Keeps track of how many reactions that have been added</span>
0211         rxnCounter=0;
0212         addSpont=false;
0213         dbLinkCounter=0;
0214         
0215         <span class="comment">%Loop through the file</span>
0216         <span class="keyword">while</span> 1
0217             <span class="comment">%Get the next line</span>
0218             tline = fgetl(fid);
0219             
0220             <span class="comment">%Abort at end of file</span>
0221             <span class="keyword">if</span> ~ischar(tline)
0222                 <span class="keyword">break</span>;
0223             <span class="keyword">end</span>
0224 
0225             <span class="comment">% Get the version of MetaCyc database</span>
0226             <span class="keyword">if</span> numel(tline)&gt;11 &amp;&amp; strcmp(tline(1:11),<span class="string">'# Version: '</span>)
0227                 version=tline(12:end);
0228             <span class="keyword">end</span>
0229 
0230             <span class="comment">%Check if it is a new reaction</span>
0231             <span class="keyword">if</span> numel(tline)&gt;12 &amp;&amp; strcmp(tline(1:12),<span class="string">'UNIQUE-ID - '</span>)
0232                 rxnCounter=rxnCounter+1;
0233                 nPwys=0;
0234                 
0235                 <span class="comment">%Add empty strings where there should be such</span>
0236                 metaCycRxns.rxnNames{rxnCounter}=<span class="string">''</span>;
0237                 metaCycRxns.eccodes{rxnCounter}=<span class="string">''</span>;
0238                 metaCycRxns.subSystems{rxnCounter}=<span class="string">''</span>;
0239                 metaCycRxns.pwys{rxnCounter}=<span class="string">''</span>;
0240                 metaCycRxns.equations{rxnCounter}=<span class="string">''</span>;
0241                 metaCycRxns.rxnReferences{rxnCounter}=<span class="string">''</span>;
0242                 reverse=0;   <span class="comment">%Value for reversing the equation when necessary</span>
0243                 
0244                 <span class="comment">% A complex evaluation system for generating the equations</span>
0245                 left{rxnCounter}=<span class="string">''</span>;
0246                 right{rxnCounter}=<span class="string">''</span>;
0247                 coefficient=<span class="string">''</span>;
0248                 templeft=<span class="string">''</span>;
0249                 tempright=<span class="string">''</span>;
0250                 <span class="comment">% might be simplified with a better algorithem</span>
0251                 
0252                 <span class="comment">%Add reaction ID</span>
0253                 metaCycRxns.rxns{rxnCounter}=tline(13:end);
0254                 
0255             <span class="keyword">end</span>
0256             
0257             <span class="comment">%Add name</span>
0258             <span class="keyword">if</span> numel(tline)&gt;14 &amp;&amp; strcmp(tline(1:14),<span class="string">'COMMON-NAME - '</span>)
0259                 metaCycRxns.rxnNames{rxnCounter}=tline(15:end);
0260                 
0261                 <span class="comment">%Romve HTML symbols</span>
0262                 metaCycRxns.rxnNames{rxnCounter}=<a href="#_sub1" class="code" title="subfunction newString=removeHTMLcodes(string)">removeHTMLcodes</a>(metaCycRxns.rxnNames{rxnCounter});
0263             <span class="keyword">end</span>
0264             
0265             <span class="comment">%Add eccodes</span>
0266             <span class="keyword">if</span> numel(tline)&gt;15 &amp;&amp; strcmp(tline(1:15),<span class="string">'EC-NUMBER - EC-'</span>)
0267                 <span class="keyword">if</span> isempty(metaCycRxns.eccodes{rxnCounter})
0268                     metaCycRxns.eccodes{rxnCounter}=strcat(<span class="string">'ec-code/'</span>,tline(16:end));
0269                 <span class="keyword">else</span>
0270                     metaCycRxns.eccodes{rxnCounter}=strcat(metaCycRxns.eccodes{rxnCounter},<span class="string">';ec-code/'</span>,tline(16:end));
0271                 <span class="keyword">end</span>
0272             <span class="keyword">end</span>
0273             <span class="keyword">if</span> numel(tline)&gt;16 &amp;&amp; strcmp(tline(1:16),<span class="string">'EC-NUMBER - |EC-'</span>)
0274                 <span class="keyword">if</span> isempty(metaCycRxns.eccodes{rxnCounter})
0275                     metaCycRxns.eccodes{rxnCounter}=strcat(<span class="string">'ec-code/'</span>,tline(17:end-1));
0276                 <span class="keyword">else</span>
0277                     metaCycRxns.eccodes{rxnCounter}=strcat(metaCycRxns.eccodes{rxnCounter},<span class="string">';ec-code/'</span>,tline(17:end-1));
0278                 <span class="keyword">end</span>
0279             <span class="keyword">end</span>
0280             
0281             <span class="comment">%Add pathway id and assign pathway name to subSystem field</span>
0282             <span class="keyword">if</span> numel(tline)&gt;13 &amp;&amp; strcmp(tline(1:13),<span class="string">'IN-PATHWAY - '</span>)
0283                 <span class="keyword">if</span> isempty(metaCycRxns.pwys{rxnCounter})
0284                     metaCycRxns.pwys{rxnCounter}=tline(14:end);
0285                 <span class="keyword">else</span>
0286                     metaCycRxns.pwys{rxnCounter}=strcat(metaCycRxns.pwys{rxnCounter},<span class="string">';'</span>,tline(14:end));
0287                 <span class="keyword">end</span>
0288                 
0289                 [x, y]=ismember(tline(14:end),pwys);
0290                 <span class="keyword">if</span> x
0291                     metaCycRxns.subSystems{rxnCounter,1}{1,numel(metaCycRxns.subSystems{rxnCounter,1})+1}=pwyNames{y};
0292                 <span class="keyword">end</span>
0293             <span class="keyword">end</span>
0294             
0295             <span class="comment">%Add references (pubmed ids)</span>
0296             <span class="keyword">if</span> numel(tline)&gt;12 &amp;&amp; strcmp(tline(1:12),<span class="string">'CITATIONS - '</span>)
0297                 <span class="keyword">if</span> isempty(metaCycRxns.rxnReferences{rxnCounter})
0298                     metaCycRxns.rxnReferences{rxnCounter}=strcat(<span class="string">'pubmed/'</span>,tline(13:end));
0299                 <span class="keyword">else</span>
0300                     metaCycRxns.rxnReferences{rxnCounter}=strcat(metaCycRxns.rxnReferences{rxnCounter},<span class="string">';pubmed/'</span>,tline(13:end));
0301                 <span class="keyword">end</span>
0302             <span class="keyword">end</span>
0303             
0304             <span class="comment">%Add Miriam info (cross-links other database)</span>
0305             <span class="keyword">if</span> numel(tline)&gt;11 &amp;&amp; strcmp(tline(1:11),<span class="string">'DBLINKS - ('</span>)
0306                 dblink=tline(12:end);
0307                 <span class="comment">%KEGG reaction id</span>
0308                 <span class="keyword">if</span> strcmp(dblink(1:12),<span class="string">'LIGAND-RXN &quot;'</span>)
0309                     dblink=dblink(13:end);
0310                     s=strfind(dblink,<span class="string">'&quot;'</span>);
0311                     <span class="keyword">if</span> any(s)
0312                         dblink=dblink(1:s-1);
0313                     <span class="keyword">end</span>
0314                     
0315                     <span class="keyword">if</span> isstruct(metaCycRxns.rxnMiriams{rxnCounter})
0316                         addToIndex=numel(metaCycRxns.rxnMiriams{rxnCounter}.name)+1;
0317                     <span class="keyword">else</span>
0318                         addToIndex=1;
0319                     <span class="keyword">end</span>
0320                     tempStruct=metaCycRxns.rxnMiriams{rxnCounter};
0321                     tempStruct.name{addToIndex,1}=<span class="string">'kegg.reaction'</span>;
0322                     tempStruct.value{addToIndex,1}=dblink;
0323                     metaCycRxns.rxnMiriams{rxnCounter}=tempStruct;
0324                     
0325                     <span class="comment">%For generating the rxnLinks structure</span>
0326                     dbLinkCounter=dbLinkCounter+1;
0327                     rxnLinks.metacyc{dbLinkCounter}=metaCycRxns.rxns{rxnCounter};
0328                     rxnLinks.kegg{dbLinkCounter}=dblink;
0329                     rxnLinks.check{dbLinkCounter}=strcat(metaCycRxns.rxns{rxnCounter},dblink);
0330                 <span class="keyword">end</span>
0331                 
0332                 <span class="comment">%RHEA reaction id</span>
0333                 <span class="keyword">if</span> strcmp(dblink(1:6),<span class="string">'RHEA &quot;'</span>)
0334                     dblink=dblink(7:end);
0335                     s=strfind(dblink,<span class="string">'&quot;'</span>);
0336                     <span class="keyword">if</span> any(s)
0337                         dblink=dblink(1:s-1);
0338                     <span class="keyword">end</span>
0339                     
0340                     <span class="keyword">if</span> isstruct(metaCycRxns.rxnMiriams{rxnCounter})
0341                         addToIndex=numel(metaCycRxns.rxnMiriams{rxnCounter}.name)+1;
0342                     <span class="keyword">else</span>
0343                         addToIndex=1;
0344                     <span class="keyword">end</span>
0345                     tempStruct=metaCycRxns.rxnMiriams{rxnCounter};
0346                     tempStruct.name{addToIndex,1}=<span class="string">'rhea'</span>;
0347                     tempStruct.value{addToIndex,1}=dblink;
0348                     metaCycRxns.rxnMiriams{rxnCounter}=tempStruct;
0349                 <span class="keyword">end</span>
0350             <span class="keyword">end</span>
0351             
0352             <span class="keyword">if</span> numel(tline)&gt;21 &amp;&amp; strcmp(tline(1:21),<span class="string">'REACTION-DIRECTION - '</span>)
0353                 rxnDirection=tline(22:end);
0354                 <span class="keyword">switch</span>(rxnDirection)
0355                     <span class="keyword">case</span> <span class="string">'IRREVERSIBLE-LEFT-TO-RIGHT'</span>
0356                         metaCycRxns.rev(rxnCounter,1)=0;
0357                     <span class="keyword">case</span> <span class="string">'LEFT-TO-RIGHT'</span>
0358                         metaCycRxns.rev(rxnCounter,1)=0;
0359                     <span class="keyword">case</span> <span class="string">'PHYSIOL-LEFT-TO-RIGHT'</span>
0360                         metaCycRxns.rev(rxnCounter,1)=0;
0361                     <span class="keyword">case</span> <span class="string">'IRREVERSIBLE-RIGHT-TO-LEFT'</span>
0362                         metaCycRxns.rev(rxnCounter,1)=0;
0363                         reverse=1;
0364                     <span class="keyword">case</span> <span class="string">'RIGHT-TO-LEFT'</span>
0365                         metaCycRxns.rev(rxnCounter,1)=0;
0366                         reverse=1;
0367                     <span class="keyword">case</span> <span class="string">'PHYSIOL-RIGHT-TO-LEFT'</span>
0368                         metaCycRxns.rev(rxnCounter,1)=0;
0369                         reverse=1;
0370                 <span class="keyword">end</span>
0371             <span class="keyword">end</span>
0372             
0373             <span class="comment">%Add spontaneous</span>
0374             <span class="keyword">if</span> strcmp(tline,<span class="string">'SPONTANEOUS? - T'</span>)
0375                 <span class="comment">%metaCycRxns.spontaneous(rxnCounter,1)=1;</span>
0376                 isSpontaneous(rxnCounter)=true;
0377             <span class="keyword">end</span>
0378             
0379             <span class="comment">%Add mass-balance information</span>
0380             <span class="keyword">if</span> strcmp(tline,<span class="string">'CANNOT-BALANCE? - T'</span>)
0381                 UNBALANCED(rxnCounter)=true;
0382             <span class="keyword">end</span>
0383             
0384             <span class="comment">%Add left side equation</span>
0385             <span class="keyword">if</span> numel(tline)&gt;7 &amp;&amp; strcmp(tline(1:7),<span class="string">'LEFT - '</span>)
0386                 <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0387                     <span class="keyword">if</span> strcmp(templeft,<span class="string">''</span>)
0388                         templeft=tline(8:end); <span class="comment">% this is the real first, save to a temp variable</span>
0389                     <span class="keyword">else</span> <span class="comment">% count in the coefficient here</span>
0390                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0391                             left{rxnCounter}=templeft;
0392                         <span class="keyword">else</span>
0393                             left{rxnCounter}=strcat(coefficient,32,templeft);
0394                             coefficient=<span class="string">''</span>;
0395                         <span class="keyword">end</span>
0396                         templeft=tline(8:end);
0397                     <span class="keyword">end</span>
0398                 <span class="keyword">else</span>
0399                     <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0400                         left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,templeft);
0401                     <span class="keyword">else</span>
0402                         left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,templeft);
0403                         coefficient=<span class="string">''</span>;
0404                     <span class="keyword">end</span>
0405                     templeft=tline(8:end);
0406                 <span class="keyword">end</span>
0407             <span class="keyword">end</span>
0408             
0409             <span class="comment">%Add right side equation</span>
0410             <span class="keyword">if</span> numel(tline)&gt;8 &amp;&amp; strcmp(tline(1:8),<span class="string">'RIGHT - '</span>)
0411                 <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0412                     <span class="keyword">if</span> strcmp(tempright,<span class="string">''</span>)
0413                         
0414                         <span class="comment">% a complicated process for the last left</span>
0415                         <span class="comment">% metabolite</span>
0416                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0417                             <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0418                                 left{rxnCounter}=templeft;
0419                             <span class="keyword">else</span>
0420                                 left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,templeft);
0421                             <span class="keyword">end</span>
0422                             
0423                         <span class="keyword">else</span>
0424                             <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0425                                 left{rxnCounter}=strcat(coefficient,32,templeft);
0426                             <span class="keyword">else</span>
0427                                 left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,templeft);
0428                             <span class="keyword">end</span>
0429                             coefficient=<span class="string">''</span>;
0430                         <span class="keyword">end</span>
0431                         <span class="comment">% process end</span>
0432                         
0433                         tempright=tline(9:end); <span class="comment">% this is the real first, save to a temp variable</span>
0434                     <span class="keyword">else</span>
0435                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0436                             right{rxnCounter}=tempright;
0437                         <span class="keyword">else</span>
0438                             right{rxnCounter}=strcat(coefficient,32,tempright);
0439                             coefficient=<span class="string">''</span>;
0440                         <span class="keyword">end</span>
0441                         tempright=tline(9:end);
0442                     <span class="keyword">end</span>
0443                 <span class="keyword">else</span>
0444                     <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0445                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,tempright);
0446                     <span class="keyword">else</span>
0447                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,tempright);
0448                         coefficient=<span class="string">''</span>;
0449                     <span class="keyword">end</span>
0450                     tempright=tline(9:end);
0451                 <span class="keyword">end</span>
0452                 
0453             <span class="keyword">end</span>
0454             
0455             <span class="keyword">if</span> numel(tline)&gt;15 &amp;&amp; strcmp(tline(1:15),<span class="string">'^COEFFICIENT - '</span>)
0456                 coefficient=tline(16:end);
0457             <span class="keyword">end</span>
0458             
0459             <span class="comment">%Generate equation at the end of each object section</span>
0460             <span class="keyword">if</span> strcmp(tline,<span class="string">'//'</span>)
0461                 
0462                 <span class="comment">% a complicated process for the last right metabolite,</span>
0463                 <span class="comment">% sub-function is needed here</span>
0464                 <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0465                     <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0466                         right{rxnCounter}=tempright;
0467                     <span class="keyword">else</span>
0468                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,tempright);
0469                     <span class="keyword">end</span>
0470                     
0471                 <span class="keyword">else</span>
0472                     <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0473                         right{rxnCounter}=strcat(coefficient,32,tempright);
0474                     <span class="keyword">else</span>
0475                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,tempright);
0476                     <span class="keyword">end</span>
0477                     coefficient=<span class="string">''</span>;
0478                 <span class="keyword">end</span>
0479                 <span class="comment">% process end</span>
0480                 
0481                 <span class="comment">%get the right direction symbol</span>
0482                 <span class="keyword">if</span> metaCycRxns.rev(rxnCounter,1)
0483                     symbol = <span class="string">' &lt;=&gt;'</span>;
0484                 <span class="keyword">else</span>
0485                     symbol = <span class="string">' =&gt;'</span>;
0486                 <span class="keyword">end</span>
0487                 
0488                 <span class="keyword">if</span> reverse
0489                     metaCycRxns.equations{rxnCounter}=strcat(right{rxnCounter},symbol,32,left{rxnCounter});
0490                 <span class="keyword">else</span>
0491                     metaCycRxns.equations{rxnCounter}=strcat(left{rxnCounter},symbol,32,right{rxnCounter});
0492                 <span class="keyword">end</span>
0493                 
0494                 <span class="comment">%Final equation check</span>
0495                 <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>) || strcmp(right{rxnCounter},<span class="string">''</span>)
0496                     rxnCounter=rxnCounter-1;
0497                     
0498                 <span class="keyword">end</span>
0499                 
0500             <span class="keyword">end</span>
0501             
0502         <span class="keyword">end</span>
0503         <span class="comment">%Close the file</span>
0504         fclose(fid);
0505         
0506         <span class="comment">%===</span>
0507         UNBALANCED=metaCycRxns.rxns(UNBALANCED);
0508         isSpontaneous=metaCycRxns.rxns(isSpontaneous);
0509         
0510         <span class="comment">%If too much space was allocated, shrink the model</span>
0511         metaCycRxns.rxns=metaCycRxns.rxns(1:rxnCounter);
0512         metaCycRxns.rxnNames=metaCycRxns.rxnNames(1:rxnCounter);
0513         metaCycRxns.eccodes=metaCycRxns.eccodes(1:rxnCounter);
0514         metaCycRxns.equations=metaCycRxns.equations(1:rxnCounter);
0515         metaCycRxns.rxnMiriams=metaCycRxns.rxnMiriams(1:rxnCounter);
0516         metaCycRxns.rxnReferences=metaCycRxns.rxnReferences(1:rxnCounter);
0517         metaCycRxns.subSystems=metaCycRxns.subSystems(1:rxnCounter);
0518         metaCycRxns.pwys=metaCycRxns.pwys(1:rxnCounter);
0519         metaCycRxns.rev=metaCycRxns.rev(1:rxnCounter,:);
0520         
0521         rxnLinks.kegg=rxnLinks.kegg(1:dbLinkCounter);
0522         rxnLinks.metacyc=rxnLinks.metacyc(1:dbLinkCounter);
0523         rxnLinks.check=rxnLinks.check(1:dbLinkCounter);
0524         [~,index]=unique(rxnLinks.check);
0525         rxnLinks.kegg=rxnLinks.kegg(index);
0526         rxnLinks.metacyc=rxnLinks.metacyc(index);
0527         rxnLinks=rmfield(rxnLinks,<span class="string">'check'</span>);
0528         
0529         <span class="comment">%Construct the S matrix and list of metabolites</span>
0530         [S, mets, badRxns]=constructS(metaCycRxns.equations);
0531         metaCycRxns.S=S;
0532         metaCycRxns.mets=mets;
0533         
0534         <span class="comment">%Add some stuff to get a correct model structure</span>
0535         metaCycRxns.ub=ones(rxnCounter,1)*1000;
0536         metaCycRxns.lb=metaCycRxns.rev*-1000;
0537         metaCycRxns.c=zeros(rxnCounter,1);
0538         metaCycRxns.b=zeros(numel(metaCycRxns.mets),1);
0539         metaCycRxns.version=version;
0540         
0541         <span class="comment">%Save the model structure</span>
0542         save(rxnsFile,<span class="string">'metaCycRxns'</span>,<span class="string">'rxnLinks'</span>,<span class="string">'TRANSPORT'</span>,<span class="string">'UNBALANCED'</span>,<span class="string">'UNDETERMINED'</span>,<span class="string">'isSpontaneous'</span>);
0543         fprintf([<span class="string">'New metaCycRxns.mat has been successfully updated!\n\n'</span>]);
0544     <span class="keyword">end</span>
0545 <span class="keyword">end</span>
0546 
0547 <span class="comment">%Deal with reactions that are labeled as &quot;TRANSPORT&quot;, &quot;UNBALANCED&quot;, or</span>
0548 <span class="comment">%&quot;UNDETERMINED&quot; (depending on settings).</span>
0549 model=metaCycRxns;
0550 <span class="keyword">if</span> keepTransportRxns==false
0551     model=removeReactions(model,intersect(TRANSPORT,model.rxns),true,true);
0552 <span class="keyword">end</span>
0553 <span class="keyword">if</span> keepUnbalanced==false
0554     model=removeReactions(model,intersect(UNBALANCED,model.rxns),true,true);
0555 <span class="keyword">end</span>
0556 <span class="keyword">if</span> keepUndetermined==false
0557     model=removeReactions(model,intersect(UNDETERMINED,model.rxns),true,true);
0558 <span class="keyword">end</span>
0559 <span class="keyword">end</span>
0560 
0561 <span class="comment">%Sub function for romving HTML symbols from the names of reaction and</span>
0562 <span class="comment">%pathway</span>
0563 <a name="_sub1" href="#_subfunctions" class="code">function newString=removeHTMLcodes(string)</a>
0564 string=regexprep(string,<span class="string">'&lt;(\w+)&gt;'</span>,<span class="string">''</span>);
0565 string=regexprep(string,<span class="string">'&lt;/(\w+)&gt;'</span>,<span class="string">''</span>);
0566 string=regexprep(string,<span class="string">'[&amp;;]'</span>,<span class="string">''</span>);
0567 newString=string;
0568 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 12-Aug-2019 13:50:41 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>