<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of exportModel</title>
  <meta name="keywords" content="exportModel">
  <meta name="description" content="exportModel">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">io</a> &gt; exportModel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for io&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>exportModel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>exportModel</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function exportModel(model,fileName,exportGeneComplexes,supressWarnings) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> exportModel
   Exports a constraint-based model to a SBML file

   model               a model structure
   fileName            the filename to export the model to
   exportGeneComplexes    true if gene complexes (all gene sets linked with
                       AND relationship) should be recognised and exported
                       (opt, default false)
   supressWarnings     true if warnings should be supressed (opt, default
                       false)

   Usage: exportModel(model,fileName,exportGeneComplexes,supressWarnings)

   Simonas Marcisauskas, 2017-10-09</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="SBMLFromExcel.html" class="code" title="function SBMLFromExcel(fileName, outputFileName,toCOBRA,printWarnings)">SBMLFromExcel</a>	SBMLFromExcel</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,fbcVersion)</a></li><li><a href="#_sub2" class="code">function miriamString=getMiriam(miriamStruct)</a></li><li><a href="#_sub3" class="code">function [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function exportModel(model,fileName,exportGeneComplexes,supressWarnings)</a>
0002 <span class="comment">% exportModel</span>
0003 <span class="comment">%   Exports a constraint-based model to a SBML file</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   model               a model structure</span>
0006 <span class="comment">%   fileName            the filename to export the model to</span>
0007 <span class="comment">%   exportGeneComplexes    true if gene complexes (all gene sets linked with</span>
0008 <span class="comment">%                       AND relationship) should be recognised and exported</span>
0009 <span class="comment">%                       (opt, default false)</span>
0010 <span class="comment">%   supressWarnings     true if warnings should be supressed (opt, default</span>
0011 <span class="comment">%                       false)</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%   Usage: exportModel(model,fileName,exportGeneComplexes,supressWarnings)</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%   Simonas Marcisauskas, 2017-10-09</span>
0016 <span class="comment">%</span>
0017 
0018 <span class="keyword">if</span> nargin&lt;3
0019     exportGeneComplexes=false;
0020 <span class="keyword">end</span>
0021 <span class="keyword">if</span> nargin&lt;4
0022     supressWarnings=false;
0023 <span class="keyword">end</span>
0024 
0025 <span class="comment">% The default SBML format settings, which are used as input for appropriate</span>
0026 <span class="comment">% libSBML functions to generate the blank SBML model structure before using</span>
0027 <span class="comment">% exporting in with OutputSBML to xml file;</span>
0028 sbmlLevel=3;
0029 sbmlVersion=1;
0030 fbcVersion=2;
0031 
0032 <span class="comment">%Check if the &quot;unconstrained&quot; field is still present. This shows if</span>
0033 <span class="comment">%exchange metabolites have been removed</span>
0034 <span class="keyword">if</span> ~isfield(model,<span class="string">'unconstrained'</span>)
0035     <span class="keyword">if</span> supressWarnings==false
0036         EM=<span class="string">'There is no unconstrained field in the model structure. This means that no metabolites are considered exchange metabolites'</span>;
0037         dispEM(EM,false);
0038     <span class="keyword">end</span>
0039     model.unconstrained=zeros(numel(model.mets),1);
0040 <span class="keyword">end</span>
0041 
0042 <span class="comment">% If model id and name (description) don't exist, make sure that default</span>
0043 <span class="comment">% strings are included;</span>
0044 <span class="keyword">if</span> ~isfield(model,<span class="string">'id'</span>)
0045     fprintf(<span class="string">'WARNING: The model is missing the &quot;id&quot; field. Uses &quot;blankID&quot;. \n'</span>);
0046     model.id=<span class="string">'blankID'</span>;
0047 <span class="keyword">end</span>;
0048 <span class="keyword">if</span> ~isfield(model,<span class="string">'description'</span>)
0049     fprintf(<span class="string">'WARNING: The model is missing the &quot;id&quot; field. Uses &quot;blankName&quot;. \n'</span>);
0050     model.description=<span class="string">'blankName'</span>;
0051 <span class="keyword">end</span>;
0052 
0053 <span class="comment">%Check the model structure</span>
0054 <span class="keyword">if</span> supressWarnings==false
0055    checkModelStruct(model,false);
0056 <span class="keyword">end</span>
0057 
0058 <span class="comment">% Adding several blank fields, if they don't exist already. This is</span>
0059 <span class="comment">% to reduce the number of conditions below;</span>
0060 <span class="keyword">if</span> ~isfield(model,<span class="string">'compMiriams'</span>)
0061     model.compMiriams=cell(numel(model.comps),1);
0062 <span class="keyword">end</span>;
0063 <span class="keyword">if</span> ~isfield(model,<span class="string">'inchis'</span>)
0064     model.inchis=cell(numel(model.mets),1);
0065 <span class="keyword">end</span>;
0066 <span class="keyword">if</span> ~isfield(model,<span class="string">'metFormulas'</span>)
0067     model.metFormulas=cell(numel(model.mets),1);
0068 <span class="keyword">end</span>;
0069 <span class="keyword">if</span> ~isfield(model,<span class="string">'metMiriams'</span>)
0070     model.metMiriams=cell(numel(model.mets),1);
0071 <span class="keyword">end</span>;
0072 
0073 <span class="keyword">if</span> ~isfield(model,<span class="string">'geneMiriams'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0074     model.geneMiriams=cell(numel(model.genes),1);
0075 <span class="keyword">end</span>;
0076 <span class="keyword">if</span> ~isfield(model,<span class="string">'subSystems'</span>)
0077     model.subSystems=cell(numel(model.rxns),1);
0078 <span class="keyword">end</span>;
0079 <span class="keyword">if</span> ~isfield(model,<span class="string">'eccodes'</span>)
0080     model.eccodes=cell(numel(model.rxns),1);
0081 <span class="keyword">end</span>;
0082 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnReferences'</span>)
0083     model.rxnReferences=cell(numel(model.rxns),1);
0084 <span class="keyword">end</span>;
0085 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnConfidenceScores'</span>)
0086     model.rxnConfidenceScores=cell(numel(model.rxns),1);
0087 <span class="keyword">end</span>;
0088 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnNotes'</span>)
0089     model.rxnNotes=cell(numel(model.rxns),1);
0090 <span class="keyword">end</span>;
0091 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnMiriams'</span>)
0092     model.rxnMiriams=cell(numel(model.rxns),1);
0093 <span class="keyword">end</span>;
0094 
0095 <span class="keyword">if</span> sbmlLevel&lt;3
0096     <span class="comment">%Check if genes have associated compartments</span>
0097     <span class="keyword">if</span> ~isfield(model,<span class="string">'geneComps'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0098         <span class="keyword">if</span> supressWarnings==false
0099             EM=<span class="string">'There are no compartments specified for genes. All genes will be assigned to the first compartment. This is because the SBML structure requires all elements to be assigned to a compartment'</span>;
0100             dispEM(EM,false);
0101         <span class="keyword">end</span>
0102         model.geneComps=ones(numel(model.genes),1);
0103     <span class="keyword">end</span>
0104 <span class="keyword">end</span>
0105 
0106 <span class="comment">% Generate an empty SBML structure;</span>
0107 modelSBML=<a href="#_sub1" class="code" title="subfunction modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,fbcVersion)">getSBMLStructure</a>(sbmlLevel,sbmlVersion,fbcVersion);
0108 modelSBML.metaid=strcat(<span class="string">'meta_'</span>,model.id);
0109 modelSBML.id=model.id;
0110 modelSBML.name=model.description;
0111 
0112 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0113     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'note'</span>)
0114         modelSBML.notes=[<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;p&gt;'</span>,regexprep(model.annotation.note,<span class="string">'&lt;p&gt;|&lt;/p&gt;'</span>,<span class="string">''</span>),<span class="string">'&lt;/p&gt;&lt;/body&gt;&lt;/notes&gt;'</span>];        
0115     <span class="keyword">end</span>
0116 <span class="keyword">else</span>
0117     modelSBML.notes=<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;p&gt;This file was generated using the exportModel function in RAVEN Toolbox 2.0 and OutputSBML in libSBML &lt;/p&gt;&lt;/body&gt;&lt;/notes&gt;'</span>;
0118 <span class="keyword">end</span>
0119 
0120 modelSBML.annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.id <span class="string">'&quot;&gt;'</span>];
0121 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0122     nameString=<span class="string">''</span>;
0123     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'familyName'</span>)
0124         <span class="keyword">if</span> ~isempty(model.annotation.familyName)
0125             nameString=[<span class="string">'&lt;vCard:Family&gt;'</span> model.annotation.familyName <span class="string">'&lt;/vCard:Family&gt;'</span>];
0126         <span class="keyword">end</span>
0127     <span class="keyword">end</span>
0128     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'givenName'</span>)
0129         <span class="keyword">if</span> ~isempty(model.annotation.givenName)
0130             nameString=[nameString <span class="string">'&lt;vCard:Given&gt;'</span> model.annotation.givenName <span class="string">'&lt;/vCard:Given&gt;'</span>];
0131         <span class="keyword">end</span>
0132     <span class="keyword">end</span>
0133     email=<span class="string">''</span>;
0134     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'email'</span>)
0135         <span class="keyword">if</span> ~isempty(model.annotation.email)
0136             email=[<span class="string">'&lt;vCard:EMAIL&gt;'</span> model.annotation.email <span class="string">'&lt;/vCard:EMAIL&gt;'</span>];
0137         <span class="keyword">end</span>
0138     <span class="keyword">end</span>
0139     org=<span class="string">''</span>;
0140     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'organization'</span>)
0141         <span class="keyword">if</span> ~isempty(model.annotation.organization)
0142             org=[<span class="string">'&lt;vCard:ORG rdf:parseType=&quot;Resource&quot;&gt;&lt;vCard:Orgname&gt;'</span> model.annotation.organization <span class="string">'&lt;/vCard:Orgname&gt;&lt;/vCard:ORG&gt;'</span>];
0143         <span class="keyword">end</span>
0144     <span class="keyword">end</span>
0145     <span class="keyword">if</span> ~isempty(nameString) || ~isempty(email) || ~isempty(org)
0146         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;dc:creator&gt;&lt;rdf:Bag&gt;&lt;rdf:li rdf:parseType=&quot;Resource&quot;&gt;'</span>];
0147         <span class="keyword">if</span> ~isempty(nameString)
0148             modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;vCard:N rdf:parseType=&quot;Resource&quot;&gt;'</span> nameString <span class="string">'&lt;/vCard:N&gt;'</span>];
0149         <span class="keyword">end</span>
0150         modelSBML.annotation=[modelSBML.annotation email org <span class="string">'&lt;/rdf:li&gt;&lt;/rdf:Bag&gt;&lt;/dc:creator&gt;'</span>];
0151     <span class="keyword">end</span>
0152 <span class="keyword">end</span>
0153 modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;dcterms:created rdf:parseType=&quot;Resource&quot;&gt;'</span><span class="keyword">...</span>
0154 <span class="string">'&lt;dcterms:W3CDTF&gt;'</span> datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SSZ'</span>) <span class="string">'&lt;/dcterms:W3CDTF&gt;'</span><span class="keyword">...</span>
0155 <span class="string">'&lt;/dcterms:created&gt;'</span><span class="keyword">...</span>
0156 <span class="string">'&lt;dcterms:modified rdf:parseType=&quot;Resource&quot;&gt;'</span><span class="keyword">...</span>
0157 <span class="string">'&lt;dcterms:W3CDTF&gt;'</span> datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SSZ'</span>) <span class="string">'&lt;/dcterms:W3CDTF&gt;'</span><span class="keyword">...</span>
0158 <span class="string">'&lt;/dcterms:modified&gt;'</span>];
0159 
0160 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0161     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'taxonomy'</span>)
0162         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;&lt;rdf:li rdf:resource=&quot;http://identifiers.org/taxonomy/'</span> regexprep(model.annotation.taxonomy,<span class="string">'taxonomy/'</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;'</span>];
0163     <span class="keyword">end</span>
0164 <span class="keyword">end</span>
0165 modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0166 
0167 <span class="comment">%Prepare compartments</span>
0168 <span class="keyword">for</span> i=1:numel(model.comps)
0169     <span class="comment">% Adding the default values, as these will be the same in all entries;</span>
0170     <span class="keyword">if</span> i==1
0171         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'sboTerm'</span>)
0172             modelSBML.compartment(i).sboTerm=290;
0173         <span class="keyword">end</span>;
0174         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'spatialDimensions'</span>)
0175             modelSBML.compartment(i).spatialDimensions=3;
0176         <span class="keyword">end</span>;
0177         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'size'</span>)
0178             modelSBML.compartment(i).size=1;
0179         <span class="keyword">end</span>;
0180         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'constant'</span>)
0181             modelSBML.compartment(i).constant=1;
0182         <span class="keyword">end</span>;
0183         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'isSetSize'</span>)
0184             modelSBML.compartment(i).isSetSize=1;
0185         <span class="keyword">end</span>;
0186         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'isSetSpatialDimensions'</span>)
0187             modelSBML.compartment(i).isSetSpatialDimensions=1;
0188         <span class="keyword">end</span>;
0189     <span class="keyword">end</span>;
0190     <span class="comment">% Copying the default values to the next entry as long as it is not the</span>
0191     <span class="comment">% last one;</span>
0192     <span class="keyword">if</span> i&lt;numel(model.comps)
0193         modelSBML.compartment(i+1)=modelSBML.compartment(i);
0194     <span class="keyword">end</span>;
0195     
0196     <span class="keyword">if</span> isfield(modelSBML.compartment,<span class="string">'metaid'</span>)
0197         modelSBML.compartment(i).metaid=[<span class="string">'meta_'</span> model.comps{i}];
0198     <span class="keyword">end</span>;
0199     <span class="comment">%Prepare Miriam strings</span>
0200     <span class="keyword">if</span> ~isempty(model.compMiriams{i}) &amp;&amp; isfield(modelSBML.compartment(i),<span class="string">'annotation'</span>)
0201         modelSBML.compartment(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.comps{i} <span class="string">'&quot;&gt;'</span>];
0202         modelSBML.compartment(i).annotation=[modelSBML.compartment(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0203         modelSBML.compartment(i).annotation=[modelSBML.compartment(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.compMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>]; 
0204     <span class="keyword">end</span>;
0205     <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'name'</span>)
0206         modelSBML.compartment(i).name=model.compNames{i};
0207     <span class="keyword">end</span>;
0208     <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'id'</span>)
0209         modelSBML.compartment(i).id=model.comps{i};
0210     <span class="keyword">end</span>;    
0211 
0212 <span class="keyword">end</span>;
0213 
0214 <span class="comment">%Begin writing species</span>
0215 <span class="keyword">for</span> i=1:numel(model.mets)
0216     <span class="comment">% Adding the default values, as these will be the same in all entries;</span>
0217     <span class="keyword">if</span> i==1
0218         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'sboTerm'</span>)
0219             modelSBML.species(i).sboTerm=247;
0220         <span class="keyword">end</span>;
0221         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'initialAmount'</span>)
0222             modelSBML.species(i).initialAmount=1;
0223         <span class="keyword">end</span>;
0224         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'initialConcentration'</span>)
0225             modelSBML.species(i).initialConcentration=0;
0226         <span class="keyword">end</span>;
0227         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'isSetInitialAmount'</span>)
0228             modelSBML.species(i).isSetInitialAmount=1;
0229         <span class="keyword">end</span>;
0230         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'isSetInitialConcentration'</span>)
0231             modelSBML.species(i).isSetInitialConcentration=1;
0232         <span class="keyword">end</span>;
0233     <span class="keyword">end</span>;
0234     <span class="comment">% Copying the default values to the next entry as long as it is not the</span>
0235     <span class="comment">% last one;</span>
0236     <span class="keyword">if</span> i&lt;numel(model.mets)
0237         modelSBML.species(i+1)=modelSBML.species(i);
0238     <span class="keyword">end</span>;
0239     
0240     <span class="keyword">if</span> isfield(modelSBML.species,<span class="string">'metaid'</span>)
0241         modelSBML.species(i).metaid=[<span class="string">'meta_M_'</span> model.mets{i}];
0242         <span class="comment">% Removing compartment abbreviation from metabolite id as we</span>
0243         <span class="comment">% save metComp in compartment subfield later;</span>
0244         modelSBML.species(i).metaid=regexprep(modelSBML.species(i).metaid,[<span class="string">'_'</span> model.comps{model.metComps(i)} <span class="string">'$'</span>],<span class="string">''</span>);
0245     <span class="keyword">end</span>;
0246     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'name'</span>)
0247         modelSBML.species(i).name=model.metNames{i};
0248     <span class="keyword">end</span>;
0249     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'id'</span>)
0250         modelSBML.species(i).id=[<span class="string">'M_'</span> model.mets{i}];
0251         <span class="comment">% Removing compartment abbreviation from metabolite id as we</span>
0252         <span class="comment">% save metComp in compartment subfield later;</span>
0253         modelSBML.species(i).id=regexprep(modelSBML.species(i).id,[<span class="string">'_'</span> model.comps{model.metComps(i)} <span class="string">'$'</span>],<span class="string">''</span>);
0254     <span class="keyword">end</span>;
0255     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'compartment'</span>)
0256         modelSBML.species(i).compartment=model.comps{model.metComps(i)};
0257     <span class="keyword">end</span>; 
0258     <span class="keyword">if</span> isfield(model,<span class="string">'unconstrained'</span>)
0259         <span class="keyword">if</span> model.unconstrained(i)
0260             modelSBML.species(i).boundaryCondition=1;
0261         <span class="keyword">end</span>;
0262     <span class="keyword">end</span>
0263     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'fbc_charge'</span>) &amp;&amp; isfield(model,<span class="string">'metCharges'</span>)
0264         <span class="keyword">if</span> ~isnan(model.metCharges(i))
0265             modelSBML.species(i).fbc_charge=model.metCharges(i);
0266             modelSBML.species(i).isSetfbc_charge=1;
0267         <span class="keyword">else</span>
0268             modelSBML.species(i).isSetfbc_charge=0;
0269         <span class="keyword">end</span>;
0270     <span class="keyword">end</span>;
0271     <span class="keyword">if</span> isfield(modelSBML.species,<span class="string">'annotation'</span>)
0272         <span class="keyword">if</span> ~isempty(model.metMiriams{i}) || ~isempty(model.metFormulas{i})
0273             hasInchi=false;
0274             <span class="keyword">if</span> ~isempty(model.metFormulas{i})
0275             <span class="comment">%Only export formula if there is no InChI. This is because the</span>
0276             <span class="comment">%metFormulas field is populated by InChIs if available</span>
0277                 <span class="keyword">if</span> ~isempty(model.inchis{i})
0278                     hasInchi=true;
0279                 <span class="keyword">end</span>;
0280                 <span class="keyword">if</span> hasInchi==false
0281                     modelSBML.species(i).fbc_chemicalFormula=model.metFormulas{i};
0282                 <span class="keyword">end</span>
0283             <span class="keyword">end</span>
0284             <span class="keyword">if</span> ~isempty(model.metMiriams{i}) || hasInchi==true
0285                 modelSBML.species(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_M_'</span> model.mets{i} <span class="string">'&quot;&gt;'</span>];
0286                 modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0287                 <span class="keyword">if</span> ~isempty(model.metMiriams{i})
0288                     modelSBML.species(i).annotation=[modelSBML.species(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.metMiriams{i})];
0289                 <span class="keyword">end</span>;
0290                 <span class="keyword">if</span> hasInchi==true
0291                     modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;rdf:li rdf:resource=&quot;http://identifiers.org/inchi/InChI='</span> model.inchis{i} <span class="string">'&quot;/&gt;'</span>];
0292                 <span class="keyword">end</span>;
0293                 modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0294             <span class="keyword">end</span>;
0295         <span class="keyword">end</span>;
0296     <span class="keyword">end</span>;
0297 <span class="keyword">end</span>; 
0298 
0299 <span class="keyword">if</span> isfield(model,<span class="string">'genes'</span>)
0300     <span class="keyword">for</span> i=1:numel(model.genes)
0301         <span class="comment">% Adding the default values, as these will be the same in all entries;</span>
0302         <span class="keyword">if</span> i==1
0303             <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'sboTerm'</span>)
0304                 modelSBML.fbc_geneProduct(i).sboTerm=252;
0305             <span class="keyword">end</span>;    
0306         <span class="keyword">end</span>;
0307         <span class="comment">% Copying the default values to the next index as long as it is not the</span>
0308         <span class="comment">% last one;</span>
0309         <span class="keyword">if</span> i&lt;numel(model.genes)
0310             modelSBML.fbc_geneProduct(i+1)=modelSBML.fbc_geneProduct(i);
0311         <span class="keyword">end</span>;
0312         
0313         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct,<span class="string">'metaid'</span>)
0314             modelSBML.fbc_geneProduct(i).metaid=[<span class="string">'meta_'</span> model.genes{i}];
0315         <span class="keyword">end</span>;
0316         <span class="keyword">if</span> ~isempty(model.geneMiriams{i}) &amp;&amp; isfield(modelSBML.fbc_geneProduct(i),<span class="string">'annotation'</span>)
0317             modelSBML.fbc_geneProduct(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.genes{i} <span class="string">'&quot;&gt;'</span>];
0318             modelSBML.fbc_geneProduct(i).annotation=[modelSBML.fbc_geneProduct(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0319             modelSBML.fbc_geneProduct(i).annotation=[modelSBML.fbc_geneProduct(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.geneMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>]; 
0320         <span class="keyword">end</span>;
0321         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'fbc_id'</span>)
0322             modelSBML.fbc_geneProduct(i).fbc_id=model.genes{i};
0323         <span class="keyword">end</span>;
0324         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'fbc_label'</span>) &amp;&amp; isfield(model,<span class="string">'geneShortNames'</span>)
0325             modelSBML.fbc_geneProduct(i).fbc_label=model.geneShortNames{i};
0326         <span class="keyword">end</span>;
0327     <span class="keyword">end</span>;
0328     <span class="keyword">if</span> exportGeneComplexes==true
0329         <span class="comment">%Also add the complexes as genes. This is done by splitting grRules</span>
0330         <span class="comment">%on &quot;or&quot; and adding the ones which contain several genes</span>
0331         geneComplexes={};
0332         <span class="keyword">if</span> isfield(model,<span class="string">'grRules'</span>)
0333             <span class="comment">%Only grRules which contain &quot; and &quot; can be complexes</span>
0334             uniqueRules=unique(model.grRules);
0335             I=cellfun(@any,strfind(uniqueRules,<span class="string">' and '</span>));
0336             uniqueRules(~I)=[];
0337             uniqueRules=strrep(uniqueRules,<span class="string">'('</span>,<span class="string">''</span>);
0338             uniqueRules=strrep(uniqueRules,<span class="string">')'</span>,<span class="string">''</span>);
0339             uniqueRules=strrep(uniqueRules,<span class="string">' and '</span>,<span class="string">':'</span>);
0340             <span class="keyword">for</span> i=1:numel(uniqueRules)
0341                 genes=regexp(uniqueRules(i),<span class="string">' or '</span>,<span class="string">'split'</span>);
0342                 genes=genes{1}(:);
0343                 <span class="comment">%Check which ones are complexes</span>
0344                 I=cellfun(@any,strfind(genes,<span class="string">':'</span>));
0345                 geneComplexes=[geneComplexes;genes(I)];
0346             <span class="keyword">end</span>
0347         <span class="keyword">end</span>
0348         geneComplexes=unique(geneComplexes);
0349         <span class="keyword">if</span> ~isempty(geneComplexes)
0350             <span class="comment">%Then add them as genes. There is a possiblity that a complex A&amp;B is</span>
0351             <span class="comment">%added as separate from B&amp;A. This isn't really an issue so I don't deal</span>
0352             <span class="comment">%with it</span>
0353             <span class="keyword">for</span> i=1:numel(geneComplexes)
0354                 modelSBML.fbc_geneProduct(numel(model.genes)+i)=modelSBML.fbc_geneProduct(1);
0355                 <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct,<span class="string">'metaid'</span>)
0356                     modelSBML.fbc_geneProduct(numel(model.genes)+i).metaid=[<span class="string">'meta_'</span> geneComplexes{i}];
0357                 <span class="keyword">end</span>;
0358                 <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct,<span class="string">'fbc_id'</span>)
0359                     modelSBML.fbc_geneProduct(numel(model.genes)+i).fbc_id=geneComplexes{i};
0360                 <span class="keyword">else</span>
0361                     modelSBML.fbc_geneProduct(i).fbc_label=modelSBML.fbc_geneProduct(i).fbc_id;
0362                 <span class="keyword">end</span>;           
0363             <span class="keyword">end</span>;
0364         <span class="keyword">end</span>;
0365     <span class="keyword">end</span>;
0366 <span class="keyword">end</span>;
0367 
0368 <span class="comment">% Generate a list of unique fbc_bound names</span>
0369 totalValues=[model.lb; model.ub];
0370 totalNames=cell(size(totalValues,1),1);
0371 
0372 listUniqueValues=unique(totalValues);
0373 
0374 <span class="keyword">for</span> i=1:length(listUniqueValues)
0375     listUniqueNames{i,1}=[<span class="string">'FB'</span>,num2str(i),<span class="string">'N'</span>,num2str(abs(round(listUniqueValues(i))))]; <span class="comment">% create unique flux bound IDs.</span>
0376     ind=find(ismember(totalValues,listUniqueValues(i)));
0377     totalNames(ind)=listUniqueNames(i,1);
0378 <span class="keyword">end</span>
0379 
0380 <span class="keyword">for</span> i=1:length(listUniqueNames)
0381     <span class="comment">% Adding the default values, as these will be the same in all entries;</span>
0382     <span class="keyword">if</span> i==1
0383         <span class="keyword">if</span> isfield(modelSBML.parameter, <span class="string">'constant'</span>)
0384             modelSBML.parameter(i).constant=1;
0385         <span class="keyword">end</span>;
0386         <span class="keyword">if</span> isfield(modelSBML.parameter, <span class="string">'isSetValue'</span>)
0387             modelSBML.parameter(i).isSetValue=1;
0388         <span class="keyword">end</span>;
0389     <span class="keyword">end</span>;
0390     <span class="comment">% Copying the default values to the next index as long as it is not the</span>
0391     <span class="comment">% last one;</span>
0392     <span class="keyword">if</span> i&lt;numel(listUniqueNames)
0393         modelSBML.parameter(i+1)=modelSBML.parameter(i);
0394     <span class="keyword">end</span>;
0395     modelSBML.parameter(i).id=listUniqueNames{i};
0396     modelSBML.parameter(i).value=listUniqueValues(i);
0397 <span class="keyword">end</span>
0398 
0399 <span class="keyword">for</span> i=1:numel(model.rxns)
0400     <span class="comment">% Adding the default values, as these will be the same in all entries;</span>
0401     <span class="keyword">if</span> i==1
0402         <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'sboTerm'</span>)
0403             modelSBML.reaction(i).sboTerm=176;
0404         <span class="keyword">end</span>;
0405         <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'isSetFast'</span>)
0406             modelSBML.reaction(i).isSetFast=1;
0407         <span class="keyword">end</span>;
0408     <span class="keyword">end</span>;
0409     <span class="comment">% Copying the default values to the next index as long as it is not the</span>
0410     <span class="comment">% last one;</span>
0411     <span class="keyword">if</span> i&lt;numel(model.rxns)
0412         modelSBML.reaction(i+1)=modelSBML.reaction(i);
0413     <span class="keyword">end</span>;
0414     
0415     <span class="keyword">if</span> isfield(modelSBML.reaction,<span class="string">'metaid'</span>)
0416         modelSBML.reaction(i).metaid=[<span class="string">'meta_R_'</span> model.rxns{i}];
0417     <span class="keyword">end</span>;
0418     
0419     <span class="comment">% Exporting notes information;</span>
0420     <span class="keyword">if</span> (~isempty(model.subSystems{i}) || ~isempty(model.rxnConfidenceScores{i}) || ~isempty(model.rxnReferences{i}) || ~isempty(model.rxnNotes{i}))
0421         modelSBML.reaction(i).notes=<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;'</span>;
0422         <span class="keyword">if</span> ~isempty(model.subSystems{i})
0423             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;SUBSYSTEM: '</span> model.subSystems{i} <span class="string">'&lt;/p&gt;'</span>];
0424         <span class="keyword">end</span>;
0425         <span class="keyword">if</span> ~isempty(model.rxnConfidenceScores{i})
0426             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;Confidence Level: '</span> model.rxnConfidenceScores{i} <span class="string">'&lt;/p&gt;'</span>];
0427         <span class="keyword">end</span>;
0428         <span class="keyword">if</span> ~isempty(model.rxnReferences{i})
0429             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;AUTHORS: '</span> model.rxnReferences{i} <span class="string">'&lt;/p&gt;'</span>];
0430         <span class="keyword">end</span>;
0431         <span class="keyword">if</span> ~isempty(model.rxnNotes{i})
0432             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;NOTES: '</span> model.rxnNotes{i} <span class="string">'&lt;/p&gt;'</span>];
0433         <span class="keyword">end</span>;
0434         modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;/body&gt;&lt;/notes&gt;'</span>];
0435     <span class="keyword">end</span>;
0436     
0437     <span class="comment">% Exporting annotation information from rxnMiriams;</span>
0438     <span class="keyword">if</span> (~isempty(model.rxnMiriams{i}) &amp;&amp; isfield(modelSBML.reaction(i),<span class="string">'annotation'</span>)) || ~isempty(model.eccodes{i})
0439         modelSBML.reaction(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_R_'</span> model.rxns{i} <span class="string">'&quot;&gt;'</span>];
0440         modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0441         <span class="keyword">if</span> ~isempty(model.eccodes{i})
0442             eccodes=regexp(model.eccodes{i},<span class="string">';'</span>,<span class="string">'split'</span>);
0443             <span class="keyword">for</span> j=1:numel(eccodes)
0444                 modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation  <span class="string">'&lt;rdf:li rdf:resource=&quot;http://identifiers.org/ec-code/'</span> regexprep(eccodes{j},<span class="string">'ec-code/|EC'</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;'</span>];
0445             <span class="keyword">end</span>;
0446         <span class="keyword">end</span>;
0447         modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.rxnMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>]; 
0448     <span class="keyword">end</span>;
0449     
0450     <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'name'</span>)
0451         modelSBML.reaction(i).name=model.rxnNames{i};
0452     <span class="keyword">end</span>;
0453     <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'id'</span>)
0454         modelSBML.reaction(i).id=[<span class="string">'R_'</span> model.rxns{i}];
0455     <span class="keyword">end</span> 
0456     
0457     <span class="comment">% Adding the information about reactants and products;</span>
0458     involvedMets=<a href="#_sub3" class="code" title="subfunction [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)">addReactantsProducts</a>(model,modelSBML,i);
0459     <span class="keyword">for</span> j=1:numel(involvedMets.reactant)
0460         <span class="keyword">if</span> j&lt;numel(involvedMets.reactant)
0461             modelSBML.reaction(i).reactant(j+1)=modelSBML.reaction(i).reactant(j);
0462         <span class="keyword">end</span>;
0463         modelSBML.reaction(i).reactant(j).species=involvedMets.reactant(j).species;
0464         modelSBML.reaction(i).reactant(j).stoichiometry=involvedMets.reactant(j).stoichiometry;
0465         modelSBML.reaction(i).reactant(j).isSetStoichiometry=involvedMets.reactant(j).isSetStoichiometry;
0466         modelSBML.reaction(i).reactant(j).constant=involvedMets.reactant(j).constant;
0467     <span class="keyword">end</span>;
0468     <span class="keyword">if</span> numel(involvedMets.reactant)==0
0469         modelSBML.reaction(i).reactant=<span class="string">''</span>;
0470     <span class="keyword">end</span>;
0471     <span class="keyword">for</span> j=1:numel(involvedMets.product)
0472         <span class="keyword">if</span> j&lt;numel(involvedMets.product)
0473             modelSBML.reaction(i).product(j+1)=modelSBML.reaction(i).product(j);
0474         <span class="keyword">end</span>;
0475         modelSBML.reaction(i).product(j).species=involvedMets.product(j).species;
0476         modelSBML.reaction(i).product(j).stoichiometry=involvedMets.product(j).stoichiometry;
0477         modelSBML.reaction(i).product(j).isSetStoichiometry=involvedMets.product(j).isSetStoichiometry;
0478         modelSBML.reaction(i).product(j).constant=involvedMets.product(j).constant;
0479     <span class="keyword">end</span>;
0480     <span class="keyword">if</span> numel(involvedMets.product)==0
0481         modelSBML.reaction(i).product=<span class="string">''</span>;
0482     <span class="keyword">end</span>;
0483     <span class="comment">%Export reversibility information. Reactions are irreversible by</span>
0484     <span class="comment">%default;</span>
0485     <span class="keyword">if</span> model.rev(i)==1
0486         modelSBML.reaction(i).reversible=1;
0487     <span class="keyword">end</span>;
0488     <span class="keyword">if</span> isfield(model, <span class="string">'rxnComps'</span>)
0489         modelSBML.reaction(i).compartment=model.comps{model.rxnComps(i)};
0490     <span class="keyword">end</span>;
0491     <span class="keyword">if</span> isfield(model, <span class="string">'grRules'</span>)
0492         modelSBML.reaction(i).fbc_geneProductAssociation.fbc_association.fbc_association=model.grRules{i};
0493     <span class="keyword">end</span>;
0494     modelSBML.reaction(i).fbc_lowerFluxBound=totalNames{i};
0495     modelSBML.reaction(i).fbc_upperFluxBound=totalNames{length(model.lb)+i};
0496 <span class="keyword">end</span>;
0497 
0498 <span class="comment">% Preparing fbc_objective subfield;</span>
0499 
0500 modelSBML.fbc_objective.fbc_type=<span class="string">'maximize'</span>;
0501 modelSBML.fbc_objective.fbc_id=<span class="string">'obj'</span>;
0502 
0503 ind=find(model.c);
0504 
0505 <span class="keyword">if</span> isempty(ind)
0506     modelSBML.fbc_objective.fbc_fluxObjective.fbc_coefficient=0;
0507 <span class="keyword">else</span>
0508     <span class="keyword">for</span> i=1:length(ind)
0509         <span class="comment">% Copying the default values to the next index as long as it is not the</span>
0510         <span class="comment">% last one;</span>
0511         <span class="keyword">if</span> i&lt;numel(ind)
0512             modelSBML.reaction(i+1)=modelSBML.reaction(i);
0513         <span class="keyword">end</span>;
0514         values=model.c(model.c~=0);
0515         modelSBML.fbc_objective(i).fbc_fluxObjective.fbc_reaction=modelSBML.reaction(ind(i)).id;
0516         modelSBML.fbc_objective(i).fbc_fluxObjective.fbc_coefficient=values(i);
0517         modelSBML.fbc_objective(i).fbc_fluxObjective.isSetfbc_coefficient=1;
0518     <span class="keyword">end</span>;
0519 <span class="keyword">end</span>;
0520 
0521 modelSBML.fbc_activeObjective=modelSBML.fbc_objective.fbc_id;
0522 
0523 fbcStr=[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/'</span>,<span class="string">'fbc/version'</span>,num2str(fbcVersion)];
0524 
0525 modelSBML.namespaces=struct(<span class="string">'prefix'</span>,{<span class="string">''</span>,<span class="string">'fbc'</span>},<span class="keyword">...</span>
0526     <span class="string">'uri'</span>,{[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/core'</span>],<span class="keyword">...</span>
0527     fbcStr});
0528 
0529 <span class="keyword">if</span> fbcVersion==2
0530     modelSBML.fbc_strict=1;
0531 <span class="keyword">end</span>;
0532 
0533 OutputSBML(modelSBML,fileName,1,0,[1,0]);
0534 
0535 <span class="keyword">end</span>
0536 
0537 <a name="_sub1" href="#_subfunctions" class="code">function modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,fbcVersion)</a>
0538 <span class="comment">%Returns the blank SBML model structure by using appropriate libSBML</span>
0539 <span class="comment">%functions. This creates structure by considering three levels</span>
0540 
0541 sbmlFieldNames=getStructureFieldnames(<span class="string">'model'</span>,sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0542 sbmlDefaultValues=getDefaultValues(<span class="string">'model'</span>,sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0543 
0544 <span class="keyword">for</span> i=1:numel(sbmlFieldNames)
0545     modelSBML.(sbmlFieldNames{1,i})=sbmlDefaultValues{1,i};
0546     sbmlSubfieldNames=getStructureFieldnames(sbmlFieldNames{1,i},sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0547     sbmlSubfieldValues=getDefaultValues(sbmlFieldNames{1,i},sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0548     <span class="keyword">if</span> ~strcmp(sbmlFieldNames{1,i},<span class="string">'event'</span>) &amp;&amp; ~strcmp(sbmlFieldNames{1,i},<span class="string">'functionDefinition'</span>) &amp;&amp; ~strcmp(sbmlFieldNames{1,i},<span class="string">'initialAssignment'</span>)
0549         <span class="keyword">for</span> j=1:numel(sbmlSubfieldNames)
0550             modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j})=sbmlSubfieldValues{1,j};
0551             sbmlSubsubfieldNames=getStructureFieldnames(sbmlSubfieldNames{1,j},sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0552             sbmlSubsubfieldValues=getDefaultValues(sbmlSubfieldNames{1,j},sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0553             <span class="keyword">if</span> ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'modifier'</span>) &amp;&amp; ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'kineticLaw'</span>)
0554                 <span class="keyword">for</span> k=1:numel(sbmlSubsubfieldNames)
0555                     <span class="comment">% 'compartment' and 'species' field are not supposed to have</span>
0556                     <span class="comment">% their standalone structures if they are subfields or</span>
0557                     <span class="comment">% subsubfields;</span>
0558                     <span class="keyword">if</span> ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'compartment'</span>) &amp;&amp; ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'species'</span>)
0559                         modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j}).(sbmlSubsubfieldNames{1,k})=sbmlSubsubfieldValues{1,k};
0560                     <span class="keyword">end</span>;   
0561                     <span class="comment">% If it is fbc_association in the third level, we need to</span>
0562                     <span class="comment">% establish the fourth level, since libSBML requires it;</span>
0563                     <span class="keyword">if</span> strcmp(sbmlSubsubfieldNames{1,k},<span class="string">'fbc_association'</span>)
0564                         fbc_associationFieldNames=getStructureFieldnames(<span class="string">'fbc_association'</span>,sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0565                         fbc_associationFieldValues=getDefaultValues(<span class="string">'fbc_association'</span>,sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0566                         <span class="keyword">for</span> l=1:numel(fbc_associationFieldNames)
0567                             modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j}).(sbmlSubsubfieldNames{1,k}).(fbc_associationFieldNames{1,l})=fbc_associationFieldValues{1,l};
0568                         <span class="keyword">end</span>;
0569                     <span class="keyword">end</span>;
0570                 <span class="keyword">end</span>;
0571             <span class="keyword">end</span>;
0572         <span class="keyword">end</span>;
0573     <span class="keyword">end</span>;
0574     <span class="keyword">if</span> ~isstruct(modelSBML.(sbmlFieldNames{1,i}))
0575         modelSBML.(sbmlFieldNames{1,i})=sbmlDefaultValues{1,i};
0576     <span class="keyword">end</span>;
0577 <span class="keyword">end</span>;
0578 
0579 modelSBML.unitDefinition.id=<span class="string">'mmol_per_gDW_per_hr'</span>;
0580 
0581 unitFieldNames=getStructureFieldnames(<span class="string">'unit'</span>,sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0582 unitDefaultValues=getDefaultValues(<span class="string">'unit'</span>,sbmlLevel,sbmlVersion,{<span class="string">'fbc'</span>},fbcVersion);
0583 
0584 kinds={<span class="string">'mole'</span>,<span class="string">'gram'</span>,<span class="string">'second'</span>};
0585 exponents=[1 -1 -1];
0586 scales=[-3 0 0];
0587 multipliers=[1 1 1*60*60];
0588 
0589 <span class="keyword">for</span> i=1:numel(unitFieldNames)
0590     modelSBML.unitDefinition.unit(1).(unitFieldNames{1,i})=unitDefaultValues{1,i};
0591     <span class="keyword">for</span> j=1:3
0592         modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=unitDefaultValues{1,i};
0593         <span class="keyword">if</span> strcmp(unitFieldNames{1,i},<span class="string">'kind'</span>)
0594             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=kinds{j};
0595         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'exponent'</span>)
0596             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=exponents(j);
0597         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'scale'</span>)
0598             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=scales(j);
0599         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'multiplier'</span>)
0600             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=multipliers(j);
0601         <span class="keyword">end</span>;            
0602     <span class="keyword">end</span>;
0603 <span class="keyword">end</span>;
0604 <span class="keyword">end</span>
0605 
0606 <a name="_sub2" href="#_subfunctions" class="code">function miriamString=getMiriam(miriamStruct)</a>
0607 <span class="comment">%Returns a string with list elements for a miriam structure ('&lt;rdf:li</span>
0608 <span class="comment">%rdf:resource=&quot;http://identifiers.org/go/GO:0005739&quot;/&gt;' for example). This is just</span>
0609 <span class="comment">%to speed ut things since this is done many times during the exporting</span>
0610 
0611 miriamString=<span class="string">''</span>;
0612 <span class="keyword">if</span> isfield(miriamStruct,<span class="string">'name'</span>)
0613     <span class="keyword">for</span> i=1:numel(miriamStruct.name)
0614         miriamString=[miriamString <span class="string">'&lt;rdf:li rdf:resource=&quot;http://identifiers.org/'</span> miriamStruct.name{i} <span class="string">'/'</span> miriamStruct.value{i} <span class="string">'&quot;/&gt;'</span>];
0615     <span class="keyword">end</span>
0616 <span class="keyword">end</span>
0617 <span class="keyword">end</span>
0618 
0619 <a name="_sub3" href="#_subfunctions" class="code">function [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)</a>
0620 <span class="comment">% This function provides reactants and products for particular reaction.</span>
0621 <span class="comment">% The function was 'borrowed' from writeSBML in COBRA toolbox, lines</span>
0622 <span class="comment">% 663-679;</span>
0623 
0624 met_idx = find(model.S(:, i));
0625 tmp_Rxn.product=[];
0626 tmp_Rxn.reactant=[];
0627 <span class="keyword">for</span> j_met=1:size(met_idx,1)
0628     tmp_idx = met_idx(j_met,1);
0629     sbml_tmp_species_ref.species = sbmlModel.species(tmp_idx).id;
0630     met_stoich = model.S(tmp_idx, i);
0631     sbml_tmp_species_ref.stoichiometry = abs(met_stoich);
0632     sbml_tmp_species_ref.isSetStoichiometry=1;
0633     sbml_tmp_species_ref.constant=1;
0634     <span class="keyword">if</span> (met_stoich &gt; 0)
0635         tmp_Rxn.product = [ tmp_Rxn.product, sbml_tmp_species_ref ];
0636     <span class="keyword">else</span>
0637         tmp_Rxn.reactant = [ tmp_Rxn.reactant, sbml_tmp_species_ref];
0638     <span class="keyword">end</span>
0639 <span class="keyword">end</span>
0640 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 01-Nov-2017 16:53:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>