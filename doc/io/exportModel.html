<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of exportModel</title>
  <meta name="keywords" content="exportModel">
  <meta name="description" content="exportModel">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">io</a> &gt; exportModel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for io&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>exportModel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>exportModel</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function exportModel(model,fileName,exportGeneComplexes,supressWarnings) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> exportModel
   Exports a constraint-based model to an SBML file (L3V1 FBCv2)

   model               a model structure
   fileName            filename to export the model to (without file extension)
   exportGeneComplexes true if gene complexes (all gene sets linked with
                       AND relationship) should be recognised and exported
                       (opt, default false)
   supressWarnings     true if warnings should be supressed (opt, default
                       false)


   Usage: exportModel(model,fileName,exportGeneComplexes,supressWarnings)

   Eduard Kerkhoven, 2018-04-12</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="SBMLFromExcel.html" class="code" title="function SBMLFromExcel(fileName, outputFileName,toCOBRA,printWarnings)">SBMLFromExcel</a>	SBMLFromExcel</li><li><a href="exportForGit.html" class="code" title="function out=exportForGit(model,prefix,path,formats)">exportForGit</a>	exportForGit</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)</a></li><li><a href="#_sub2" class="code">function miriamString=getMiriam(miriamStruct)</a></li><li><a href="#_sub3" class="code">function [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)</a></li><li><a href="#_sub4" class="code">function vecT = columnVector(vec)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function exportModel(model,fileName,exportGeneComplexes,supressWarnings)</a>
0002 <span class="comment">% exportModel</span>
0003 <span class="comment">%   Exports a constraint-based model to an SBML file (L3V1 FBCv2)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   model               a model structure</span>
0006 <span class="comment">%   fileName            filename to export the model to (without file extension)</span>
0007 <span class="comment">%   exportGeneComplexes true if gene complexes (all gene sets linked with</span>
0008 <span class="comment">%                       AND relationship) should be recognised and exported</span>
0009 <span class="comment">%                       (opt, default false)</span>
0010 <span class="comment">%   supressWarnings     true if warnings should be supressed (opt, default</span>
0011 <span class="comment">%                       false)</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%   Usage: exportModel(model,fileName,exportGeneComplexes,supressWarnings)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%   Eduard Kerkhoven, 2018-04-12</span>
0017 
0018 <span class="keyword">if</span> nargin&lt;3
0019     exportGeneComplexes=false;
0020 <span class="keyword">end</span>
0021 <span class="keyword">if</span> nargin&lt;4
0022     supressWarnings=false;
0023 <span class="keyword">end</span>
0024 
0025 <span class="comment">%The default SBML format settings, which are used as input for appropriate</span>
0026 <span class="comment">%libSBML functions to generate the blank SBML model structure before using</span>
0027 <span class="comment">%exporting in with OutputSBML to xml file</span>
0028 sbmlLevel=3;
0029 sbmlVersion=1;
0030 sbmlPackages = {<span class="string">'fbc'</span>,<span class="string">'groups'</span>};
0031 sbmlPackageVersions = [2,1];
0032 
0033 <span class="comment">%Check if the &quot;unconstrained&quot; field is still present. This shows if</span>
0034 <span class="comment">%exchange metabolites have been removed</span>
0035 <span class="keyword">if</span> ~isfield(model,<span class="string">'unconstrained'</span>)
0036     <span class="keyword">if</span> supressWarnings==false
0037         EM=<span class="string">'There is no unconstrained field in the model structure. This means that no metabolites are considered exchange metabolites'</span>;
0038         dispEM(EM,false);
0039     <span class="keyword">end</span>
0040     model.unconstrained=zeros(numel(model.mets),1);
0041 <span class="keyword">end</span>
0042 
0043 <span class="comment">%If model id and name (description) don't exist, make sure that default</span>
0044 <span class="comment">%strings are included</span>
0045 <span class="keyword">if</span> ~isfield(model,<span class="string">'id'</span>)
0046     fprintf(<span class="string">'WARNING: The model is missing the &quot;id&quot; field. Uses &quot;blankID&quot;. \n'</span>);
0047     model.id=<span class="string">'blankID'</span>;
0048 <span class="keyword">end</span>
0049 <span class="keyword">if</span> ~isfield(model,<span class="string">'description'</span>)
0050     fprintf(<span class="string">'WARNING: The model is missing the &quot;id&quot; field. Uses &quot;blankName&quot;. \n'</span>);
0051     model.description=<span class="string">'blankName'</span>;
0052 <span class="keyword">end</span>
0053 
0054 <span class="comment">%Check the model structure</span>
0055 <span class="keyword">if</span> supressWarnings==false
0056     checkModelStruct(model,false);
0057 <span class="keyword">end</span>
0058 
0059 <span class="comment">%Add several blank fields, if they don't exist already. This is to reduce</span>
0060 <span class="comment">%the number of conditions below</span>
0061 <span class="keyword">if</span> ~isfield(model,<span class="string">'compMiriams'</span>)
0062     model.compMiriams=cell(numel(model.comps),1);
0063 <span class="keyword">end</span>
0064 <span class="keyword">if</span> ~isfield(model,<span class="string">'inchis'</span>)
0065     model.inchis=cell(numel(model.mets),1);
0066 <span class="keyword">end</span>
0067 <span class="keyword">if</span> ~isfield(model,<span class="string">'metFormulas'</span>)
0068     model.metFormulas=cell(numel(model.mets),1);
0069 <span class="keyword">end</span>
0070 <span class="keyword">if</span> ~isfield(model,<span class="string">'metMiriams'</span>)
0071     model.metMiriams=cell(numel(model.mets),1);
0072 <span class="keyword">end</span>
0073 <span class="keyword">if</span> ~isfield(model,<span class="string">'geneMiriams'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0074     model.geneMiriams=cell(numel(model.genes),1);
0075 <span class="keyword">end</span>
0076 <span class="keyword">if</span> ~isfield(model,<span class="string">'subSystems'</span>)
0077     model.subSystems=cell(numel(model.rxns),1);
0078 <span class="keyword">end</span>
0079 <span class="keyword">if</span> ~isfield(model,<span class="string">'eccodes'</span>)
0080     model.eccodes=cell(numel(model.rxns),1);
0081 <span class="keyword">end</span>
0082 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnReferences'</span>)
0083     model.rxnReferences=cell(numel(model.rxns),1);
0084 <span class="keyword">end</span>
0085 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnConfidenceScores'</span>)
0086     model.rxnConfidenceScores=NaN(numel(model.rxns),1);
0087 <span class="keyword">end</span>
0088 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnNotes'</span>)
0089     model.rxnNotes=cell(numel(model.rxns),1);
0090 <span class="keyword">end</span>
0091 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnMiriams'</span>)
0092     model.rxnMiriams=cell(numel(model.rxns),1);
0093 <span class="keyword">end</span>
0094 
0095 <span class="keyword">if</span> sbmlLevel&lt;3
0096     <span class="comment">%Check if genes have associated compartments</span>
0097     <span class="keyword">if</span> ~isfield(model,<span class="string">'geneComps'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0098         <span class="keyword">if</span> supressWarnings==false
0099             EM=<span class="string">'There are no compartments specified for genes. All genes will be assigned to the first compartment. This is because the SBML structure requires all elements to be assigned to a compartment'</span>;
0100             dispEM(EM,false);
0101         <span class="keyword">end</span>
0102         model.geneComps=ones(numel(model.genes),1);
0103     <span class="keyword">end</span>
0104 <span class="keyword">end</span>
0105 
0106 <span class="comment">%Convert ids to SBML-convenient format. This is to avoid the data loss when</span>
0107 <span class="comment">%unsupported characters are included in ids. Here we are using part from</span>
0108 <span class="comment">%convertSBMLID, originating from the COBRA Toolbox</span>
0109 model.rxns=regexprep(model.rxns,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0110 model.mets=regexprep(model.mets,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0111 model.comps=regexprep(model.comps,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0112 model.genes=regexprep(model.genes,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0113 
0114 <span class="comment">%Generate an empty SBML structure</span>
0115 modelSBML=<a href="#_sub1" class="code" title="subfunction modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)">getSBMLStructure</a>(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0116 modelSBML.metaid=model.id;
0117 modelSBML.id=model.id;
0118 modelSBML.name=model.description;
0119 
0120 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0121     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'note'</span>)
0122         modelSBML.notes=[<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;p&gt;'</span>,regexprep(model.annotation.note,<span class="string">'&lt;p&gt;|&lt;/p&gt;'</span>,<span class="string">''</span>),<span class="string">'&lt;/p&gt;&lt;/body&gt;&lt;/notes&gt;'</span>];
0123     <span class="keyword">end</span>
0124 <span class="keyword">else</span>
0125     modelSBML.notes=<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;p&gt;This file was generated using the exportModel function in RAVEN Toolbox 2.0 and OutputSBML in libSBML &lt;/p&gt;&lt;/body&gt;&lt;/notes&gt;'</span>;
0126 <span class="keyword">end</span>
0127 
0128 modelSBML.annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.id <span class="string">'&quot;&gt;'</span>];
0129 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0130     nameString=<span class="string">''</span>;
0131     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'familyName'</span>)
0132         <span class="keyword">if</span> ~isempty(model.annotation.familyName)
0133             nameString=[<span class="string">'&lt;vCard:Family&gt;'</span> model.annotation.familyName <span class="string">'&lt;/vCard:Family&gt;'</span>];
0134         <span class="keyword">end</span>
0135     <span class="keyword">end</span>
0136     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'givenName'</span>)
0137         <span class="keyword">if</span> ~isempty(model.annotation.givenName)
0138             nameString=[nameString <span class="string">'&lt;vCard:Given&gt;'</span> model.annotation.givenName <span class="string">'&lt;/vCard:Given&gt;'</span>];
0139         <span class="keyword">end</span>
0140     <span class="keyword">end</span>
0141     email=<span class="string">''</span>;
0142     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'email'</span>)
0143         <span class="keyword">if</span> ~isempty(model.annotation.email)
0144             email=[<span class="string">'&lt;vCard:EMAIL&gt;'</span> model.annotation.email <span class="string">'&lt;/vCard:EMAIL&gt;'</span>];
0145         <span class="keyword">end</span>
0146     <span class="keyword">end</span>
0147     org=<span class="string">''</span>;
0148     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'organization'</span>)
0149         <span class="keyword">if</span> ~isempty(model.annotation.organization)
0150             org=[<span class="string">'&lt;vCard:ORG rdf:parseType=&quot;Resource&quot;&gt;&lt;vCard:Orgname&gt;'</span> model.annotation.organization <span class="string">'&lt;/vCard:Orgname&gt;&lt;/vCard:ORG&gt;'</span>];
0151         <span class="keyword">end</span>
0152     <span class="keyword">end</span>
0153     <span class="keyword">if</span> ~isempty(nameString) || ~isempty(email) || ~isempty(org)
0154         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;dc:creator&gt;&lt;rdf:Bag&gt;&lt;rdf:li rdf:parseType=&quot;Resource&quot;&gt;'</span>];
0155         <span class="keyword">if</span> ~isempty(nameString)
0156             modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;vCard:N rdf:parseType=&quot;Resource&quot;&gt;'</span> nameString <span class="string">'&lt;/vCard:N&gt;'</span>];
0157         <span class="keyword">end</span>
0158         modelSBML.annotation=[modelSBML.annotation email org <span class="string">'&lt;/rdf:li&gt;&lt;/rdf:Bag&gt;&lt;/dc:creator&gt;'</span>];
0159     <span class="keyword">end</span>
0160 <span class="keyword">end</span>
0161 modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;dcterms:created rdf:parseType=&quot;Resource&quot;&gt;'</span><span class="keyword">...</span>
0162     <span class="string">'&lt;dcterms:W3CDTF&gt;'</span> datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SSZ'</span>) <span class="string">'&lt;/dcterms:W3CDTF&gt;'</span><span class="keyword">...</span>
0163     <span class="string">'&lt;/dcterms:created&gt;'</span><span class="keyword">...</span>
0164     <span class="string">'&lt;dcterms:modified rdf:parseType=&quot;Resource&quot;&gt;'</span><span class="keyword">...</span>
0165     <span class="string">'&lt;dcterms:W3CDTF&gt;'</span> datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SSZ'</span>) <span class="string">'&lt;/dcterms:W3CDTF&gt;'</span><span class="keyword">...</span>
0166     <span class="string">'&lt;/dcterms:modified&gt;'</span>];
0167 
0168 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0169     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'taxonomy'</span>)
0170         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;&lt;rdf:li rdf:resource=&quot;http://identifiers.org/taxonomy/'</span> regexprep(model.annotation.taxonomy,<span class="string">'taxonomy/'</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;'</span>];
0171     <span class="keyword">end</span>
0172 <span class="keyword">end</span>
0173 modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0174 
0175 <span class="comment">%Prepare compartments</span>
0176 <span class="keyword">for</span> i=1:numel(model.comps)
0177     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0178     <span class="keyword">if</span> i==1
0179         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'sboTerm'</span>)
0180             modelSBML.compartment(i).sboTerm=290;
0181         <span class="keyword">end</span>
0182         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'spatialDimensions'</span>)
0183             modelSBML.compartment(i).spatialDimensions=3;
0184         <span class="keyword">end</span>
0185         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'size'</span>)
0186             modelSBML.compartment(i).size=1;
0187         <span class="keyword">end</span>
0188         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'constant'</span>)
0189             modelSBML.compartment(i).constant=1;
0190         <span class="keyword">end</span>
0191         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'isSetSize'</span>)
0192             modelSBML.compartment(i).isSetSize=1;
0193         <span class="keyword">end</span>
0194         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'isSetSpatialDimensions'</span>)
0195             modelSBML.compartment(i).isSetSpatialDimensions=1;
0196         <span class="keyword">end</span>
0197     <span class="keyword">end</span>
0198     <span class="comment">%Copy the default values to the next entry as long as it is not the</span>
0199     <span class="comment">%last one</span>
0200     <span class="keyword">if</span> i&lt;numel(model.comps)
0201         modelSBML.compartment(i+1)=modelSBML.compartment(i);
0202     <span class="keyword">end</span>
0203     
0204     <span class="keyword">if</span> isfield(modelSBML.compartment,<span class="string">'metaid'</span>)
0205         modelSBML.compartment(i).metaid=model.comps{i};
0206     <span class="keyword">end</span>
0207     <span class="comment">%Prepare Miriam strings</span>
0208     <span class="keyword">if</span> ~isempty(model.compMiriams{i}) &amp;&amp; isfield(modelSBML.compartment(i),<span class="string">'annotation'</span>)
0209         modelSBML.compartment(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.comps{i} <span class="string">'&quot;&gt;'</span>];
0210         modelSBML.compartment(i).annotation=[modelSBML.compartment(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0211         modelSBML.compartment(i).annotation=[modelSBML.compartment(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.compMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0212     <span class="keyword">end</span>
0213     <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'name'</span>)
0214         modelSBML.compartment(i).name=model.compNames{i};
0215     <span class="keyword">end</span>
0216     <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'id'</span>)
0217         modelSBML.compartment(i).id=model.comps{i};
0218     <span class="keyword">end</span>
0219     
0220 <span class="keyword">end</span>
0221 
0222 <span class="comment">%Begin writing species</span>
0223 <span class="keyword">for</span> i=1:numel(model.mets)
0224     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0225     <span class="keyword">if</span> i==1
0226         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'sboTerm'</span>)
0227             modelSBML.species(i).sboTerm=247;
0228         <span class="keyword">end</span>
0229         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'initialAmount'</span>)
0230             modelSBML.species(i).initialAmount=1;
0231         <span class="keyword">end</span>
0232         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'initialConcentration'</span>)
0233             modelSBML.species(i).initialConcentration=0;
0234         <span class="keyword">end</span>
0235         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'isSetInitialAmount'</span>)
0236             modelSBML.species(i).isSetInitialAmount=1;
0237         <span class="keyword">end</span>
0238         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'isSetInitialConcentration'</span>)
0239             modelSBML.species(i).isSetInitialConcentration=1;
0240         <span class="keyword">end</span>
0241     <span class="keyword">end</span>
0242     <span class="comment">%Copy the default values to the next entry as long as it is not the</span>
0243     <span class="comment">%last one</span>
0244     <span class="keyword">if</span> i&lt;numel(model.mets)
0245         modelSBML.species(i+1)=modelSBML.species(i);
0246     <span class="keyword">end</span>
0247     
0248     <span class="keyword">if</span> isfield(modelSBML.species,<span class="string">'metaid'</span>)
0249         modelSBML.species(i).metaid=[<span class="string">'M_'</span> model.mets{i}];
0250     <span class="keyword">end</span>
0251     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'name'</span>)
0252         modelSBML.species(i).name=model.metNames{i};
0253     <span class="keyword">end</span>
0254     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'id'</span>)
0255         modelSBML.species(i).id=[<span class="string">'M_'</span> model.mets{i}];
0256     <span class="keyword">end</span>
0257     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'compartment'</span>)
0258         modelSBML.species(i).compartment=model.comps{model.metComps(i)};
0259     <span class="keyword">end</span>
0260     <span class="keyword">if</span> isfield(model,<span class="string">'unconstrained'</span>)
0261         <span class="keyword">if</span> model.unconstrained(i)
0262             modelSBML.species(i).boundaryCondition=1;
0263         <span class="keyword">end</span>
0264     <span class="keyword">end</span>
0265     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'fbc_charge'</span>) &amp;&amp; isfield(model,<span class="string">'metCharges'</span>)
0266         <span class="keyword">if</span> ~isnan(model.metCharges(i))
0267             modelSBML.species(i).fbc_charge=model.metCharges(i);
0268             modelSBML.species(i).isSetfbc_charge=1;
0269         <span class="keyword">else</span>
0270             modelSBML.species(i).isSetfbc_charge=0;
0271         <span class="keyword">end</span>
0272     <span class="keyword">end</span>
0273     <span class="keyword">if</span> isfield(modelSBML.species,<span class="string">'annotation'</span>)
0274         <span class="keyword">if</span> ~isempty(model.metMiriams{i}) || ~isempty(model.metFormulas{i})
0275             hasInchi=false;
0276             <span class="keyword">if</span> ~isempty(model.metFormulas{i})
0277                 <span class="comment">%Only export formula if there is no InChI. This is because</span>
0278                 <span class="comment">%the metFormulas field is populated by InChIs if available</span>
0279                 <span class="keyword">if</span> ~isempty(model.inchis{i})
0280                     hasInchi=true;
0281                 <span class="keyword">end</span>
0282                 <span class="keyword">if</span> hasInchi==false
0283                     modelSBML.species(i).fbc_chemicalFormula=model.metFormulas{i};
0284                 <span class="keyword">end</span>
0285             <span class="keyword">end</span>
0286             <span class="keyword">if</span> ~isempty(model.metMiriams{i}) || hasInchi==true
0287                 modelSBML.species(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_M_'</span> model.mets{i} <span class="string">'&quot;&gt;'</span>];
0288                 modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0289                 <span class="keyword">if</span> ~isempty(model.metMiriams{i})
0290                     modelSBML.species(i).annotation=[modelSBML.species(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.metMiriams{i})];
0291                 <span class="keyword">end</span>
0292                 <span class="keyword">if</span> hasInchi==true
0293                     modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;rdf:li rdf:resource=&quot;http://identifiers.org/inchi/InChI='</span> model.inchis{i} <span class="string">'&quot;/&gt;'</span>];
0294                 <span class="keyword">end</span>
0295                 modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0296             <span class="keyword">end</span>
0297         <span class="keyword">end</span>
0298     <span class="keyword">end</span>
0299 <span class="keyword">end</span>
0300 
0301 <span class="keyword">if</span> isfield(model,<span class="string">'genes'</span>)
0302     <span class="keyword">for</span> i=1:numel(model.genes)
0303         <span class="comment">%Add the default values, as these will be the same in all entries</span>
0304         <span class="keyword">if</span> i==1
0305             <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'sboTerm'</span>)
0306                 modelSBML.fbc_geneProduct(i).sboTerm=252;
0307             <span class="keyword">end</span>
0308         <span class="keyword">end</span>
0309         <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0310         <span class="comment">%last one</span>
0311         <span class="keyword">if</span> i&lt;numel(model.genes)
0312             modelSBML.fbc_geneProduct(i+1)=modelSBML.fbc_geneProduct(i);
0313         <span class="keyword">end</span>
0314         
0315         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct,<span class="string">'metaid'</span>)
0316             modelSBML.fbc_geneProduct(i).metaid=model.genes{i};
0317         <span class="keyword">end</span>
0318         <span class="keyword">if</span> ~isempty(model.geneMiriams{i}) &amp;&amp; isfield(modelSBML.fbc_geneProduct(i),<span class="string">'annotation'</span>)
0319             modelSBML.fbc_geneProduct(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.genes{i} <span class="string">'&quot;&gt;'</span>];
0320             modelSBML.fbc_geneProduct(i).annotation=[modelSBML.fbc_geneProduct(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0321             modelSBML.fbc_geneProduct(i).annotation=[modelSBML.fbc_geneProduct(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.geneMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0322         <span class="keyword">end</span>
0323         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'fbc_id'</span>)
0324             modelSBML.fbc_geneProduct(i).fbc_id=model.genes{i};
0325         <span class="keyword">end</span>
0326         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'fbc_label'</span>) &amp;&amp; isfield(model,<span class="string">'geneShortNames'</span>)
0327             modelSBML.fbc_geneProduct(i).fbc_label=model.geneShortNames{i};
0328         <span class="keyword">end</span>
0329     <span class="keyword">end</span>
0330     <span class="keyword">if</span> exportGeneComplexes==true
0331         <span class="comment">%Also add the complexes as genes. This is done by splitting grRules</span>
0332         <span class="comment">%on &quot;or&quot; and adding the ones which contain several genes</span>
0333         geneComplexes={};
0334         <span class="keyword">if</span> isfield(model,<span class="string">'grRules'</span>)
0335             <span class="comment">%Only grRules which contain &quot; and &quot; can be complexes</span>
0336             uniqueRules=unique(model.grRules);
0337             I=cellfun(@any,strfind(uniqueRules,<span class="string">' and '</span>));
0338             uniqueRules(~I)=[];
0339             uniqueRules=strrep(uniqueRules,<span class="string">'('</span>,<span class="string">''</span>);
0340             uniqueRules=strrep(uniqueRules,<span class="string">')'</span>,<span class="string">''</span>);
0341             uniqueRules=strrep(uniqueRules,<span class="string">' and '</span>,<span class="string">':'</span>);
0342             <span class="keyword">for</span> i=1:numel(uniqueRules)
0343                 genes=regexp(uniqueRules(i),<span class="string">' or '</span>,<span class="string">'split'</span>);
0344                 genes=genes{1}(:);
0345                 <span class="comment">%Check which ones are complexes</span>
0346                 I=cellfun(@any,strfind(genes,<span class="string">':'</span>));
0347                 geneComplexes=[geneComplexes;genes(I)];
0348             <span class="keyword">end</span>
0349         <span class="keyword">end</span>
0350         geneComplexes=unique(geneComplexes);
0351         <span class="keyword">if</span> ~isempty(geneComplexes)
0352             <span class="comment">%Then add them as genes. There is a possiblity that a complex</span>
0353             <span class="comment">%A&amp;B is added as separate from B&amp;A. This isn't really an issue</span>
0354             <span class="comment">%so I don't deal with it</span>
0355             <span class="keyword">for</span> i=1:numel(geneComplexes)
0356                 modelSBML.fbc_geneProduct(numel(model.genes)+i)=modelSBML.fbc_geneProduct(1);
0357                 <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct,<span class="string">'metaid'</span>)
0358                     modelSBML.fbc_geneProduct(numel(model.genes)+i).metaid=geneComplexes{i};
0359                 <span class="keyword">end</span>
0360                 <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct,<span class="string">'fbc_id'</span>)
0361                     modelSBML.fbc_geneProduct(numel(model.genes)+i).fbc_id=geneComplexes{i};
0362                 <span class="keyword">else</span>
0363                     modelSBML.fbc_geneProduct(i).fbc_label=modelSBML.fbc_geneProduct(i).fbc_id;
0364                 <span class="keyword">end</span>
0365             <span class="keyword">end</span>
0366         <span class="keyword">end</span>
0367     <span class="keyword">end</span>
0368 <span class="keyword">end</span>
0369 
0370 <span class="comment">%Generate a list of unique fbc_bound names</span>
0371 totalValues=[model.lb; model.ub];
0372 totalNames=cell(size(totalValues,1),1);
0373 
0374 listUniqueValues=unique(totalValues);
0375 
0376 <span class="keyword">for</span> i=1:length(listUniqueValues)
0377     listUniqueNames{i,1}=[<span class="string">'FB'</span>,num2str(i),<span class="string">'N'</span>,num2str(abs(round(listUniqueValues(i))))]; <span class="comment">% create unique flux bound IDs.</span>
0378     ind=find(ismember(totalValues,listUniqueValues(i)));
0379     totalNames(ind)=listUniqueNames(i,1);
0380 <span class="keyword">end</span>
0381 
0382 <span class="keyword">for</span> i=1:length(listUniqueNames)
0383     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0384     <span class="keyword">if</span> i==1
0385         <span class="keyword">if</span> isfield(modelSBML.parameter, <span class="string">'constant'</span>)
0386             modelSBML.parameter(i).constant=1;
0387         <span class="keyword">end</span>
0388         <span class="keyword">if</span> isfield(modelSBML.parameter, <span class="string">'isSetValue'</span>)
0389             modelSBML.parameter(i).isSetValue=1;
0390         <span class="keyword">end</span>
0391     <span class="keyword">end</span>
0392     <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0393     <span class="comment">%last one</span>
0394     <span class="keyword">if</span> i&lt;numel(listUniqueNames)
0395         modelSBML.parameter(i+1)=modelSBML.parameter(i);
0396     <span class="keyword">end</span>
0397     modelSBML.parameter(i).id=listUniqueNames{i};
0398     modelSBML.parameter(i).value=listUniqueValues(i);
0399 <span class="keyword">end</span>
0400 
0401 <span class="keyword">for</span> i=1:numel(model.rxns)
0402     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0403     <span class="keyword">if</span> i==1
0404         <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'sboTerm'</span>)
0405             modelSBML.reaction(i).sboTerm=176;
0406         <span class="keyword">end</span>
0407         <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'isSetFast'</span>)
0408             modelSBML.reaction(i).isSetFast=1;
0409         <span class="keyword">end</span>
0410     <span class="keyword">end</span>
0411     <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0412     <span class="comment">%last one</span>
0413     <span class="keyword">if</span> i&lt;numel(model.rxns)
0414         modelSBML.reaction(i+1)=modelSBML.reaction(i);
0415     <span class="keyword">end</span>
0416     
0417     <span class="keyword">if</span> isfield(modelSBML.reaction,<span class="string">'metaid'</span>)
0418         modelSBML.reaction(i).metaid=[<span class="string">'R_'</span> model.rxns{i}];
0419     <span class="keyword">end</span>
0420     
0421     <span class="comment">%Export notes information</span>
0422     <span class="keyword">if</span> (~isnan(model.rxnConfidenceScores(i)) || ~isempty(model.rxnReferences{i}) || ~isempty(model.rxnNotes{i}))
0423         modelSBML.reaction(i).notes=<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;'</span>;
0424         <span class="keyword">if</span> ~isnan(model.rxnConfidenceScores(i))
0425             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;Confidence Level: '</span> num2str(model.rxnConfidenceScores(i)) <span class="string">'&lt;/p&gt;'</span>];
0426         <span class="keyword">end</span>
0427         <span class="keyword">if</span> ~isempty(model.rxnReferences{i})
0428             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;AUTHORS: '</span> model.rxnReferences{i} <span class="string">'&lt;/p&gt;'</span>];
0429         <span class="keyword">end</span>
0430         <span class="keyword">if</span> ~isempty(model.rxnNotes{i})
0431             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;NOTES: '</span> model.rxnNotes{i} <span class="string">'&lt;/p&gt;'</span>];
0432         <span class="keyword">end</span>
0433         modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;/body&gt;&lt;/notes&gt;'</span>];
0434     <span class="keyword">end</span>
0435     
0436     <span class="comment">%Export annotation information from rxnMiriams</span>
0437     <span class="keyword">if</span> (~isempty(model.rxnMiriams{i}) &amp;&amp; isfield(modelSBML.reaction(i),<span class="string">'annotation'</span>)) || ~isempty(model.eccodes{i})
0438         modelSBML.reaction(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_R_'</span> model.rxns{i} <span class="string">'&quot;&gt;'</span>];
0439         modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0440         <span class="keyword">if</span> ~isempty(model.eccodes{i})
0441             eccodes=regexp(model.eccodes{i},<span class="string">';'</span>,<span class="string">'split'</span>);
0442             <span class="keyword">for</span> j=1:numel(eccodes)
0443                 modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation  <span class="string">'&lt;rdf:li rdf:resource=&quot;http://identifiers.org/ec-code/'</span> regexprep(eccodes{j},<span class="string">'ec-code/|EC'</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;'</span>];
0444             <span class="keyword">end</span>
0445         <span class="keyword">end</span>
0446         modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.rxnMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0447     <span class="keyword">end</span>
0448     
0449     <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'name'</span>)
0450         modelSBML.reaction(i).name=model.rxnNames{i};
0451     <span class="keyword">end</span>
0452     <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'id'</span>)
0453         modelSBML.reaction(i).id=[<span class="string">'R_'</span> model.rxns{i}];
0454     <span class="keyword">end</span>
0455     
0456     <span class="comment">%Add the information about reactants and products</span>
0457     involvedMets=<a href="#_sub3" class="code" title="subfunction [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)">addReactantsProducts</a>(model,modelSBML,i);
0458     <span class="keyword">for</span> j=1:numel(involvedMets.reactant)
0459         <span class="keyword">if</span> j&lt;numel(involvedMets.reactant)
0460             modelSBML.reaction(i).reactant(j+1)=modelSBML.reaction(i).reactant(j);
0461         <span class="keyword">end</span>
0462         modelSBML.reaction(i).reactant(j).species=involvedMets.reactant(j).species;
0463         modelSBML.reaction(i).reactant(j).stoichiometry=involvedMets.reactant(j).stoichiometry;
0464         modelSBML.reaction(i).reactant(j).isSetStoichiometry=involvedMets.reactant(j).isSetStoichiometry;
0465         modelSBML.reaction(i).reactant(j).constant=involvedMets.reactant(j).constant;
0466     <span class="keyword">end</span>
0467     <span class="keyword">if</span> numel(involvedMets.reactant)==0
0468         modelSBML.reaction(i).reactant=<span class="string">''</span>;
0469     <span class="keyword">end</span>
0470     <span class="keyword">for</span> j=1:numel(involvedMets.product)
0471         <span class="keyword">if</span> j&lt;numel(involvedMets.product)
0472             modelSBML.reaction(i).product(j+1)=modelSBML.reaction(i).product(j);
0473         <span class="keyword">end</span>
0474         modelSBML.reaction(i).product(j).species=involvedMets.product(j).species;
0475         modelSBML.reaction(i).product(j).stoichiometry=involvedMets.product(j).stoichiometry;
0476         modelSBML.reaction(i).product(j).isSetStoichiometry=involvedMets.product(j).isSetStoichiometry;
0477         modelSBML.reaction(i).product(j).constant=involvedMets.product(j).constant;
0478     <span class="keyword">end</span>
0479     <span class="keyword">if</span> numel(involvedMets.product)==0
0480         modelSBML.reaction(i).product=<span class="string">''</span>;
0481     <span class="keyword">end</span>
0482     <span class="comment">%Export reversibility information. Reactions are irreversible by</span>
0483     <span class="comment">%default</span>
0484     <span class="keyword">if</span> model.rev(i)==1
0485         modelSBML.reaction(i).reversible=1;
0486     <span class="keyword">end</span>
0487     <span class="keyword">if</span> isfield(model, <span class="string">'rxnComps'</span>)
0488         modelSBML.reaction(i).compartment=model.comps{model.rxnComps(i)};
0489     <span class="keyword">end</span>
0490     <span class="keyword">if</span> isfield(model, <span class="string">'grRules'</span>)
0491         modelSBML.reaction(i).fbc_geneProductAssociation.fbc_association.fbc_association=model.grRules{i};
0492     <span class="keyword">end</span>
0493     modelSBML.reaction(i).fbc_lowerFluxBound=totalNames{i};
0494     modelSBML.reaction(i).fbc_upperFluxBound=totalNames{length(model.lb)+i};
0495 <span class="keyword">end</span>
0496 
0497 <span class="comment">%Prepare subSystems Code taken from COBRA functions getModelSubSystems,</span>
0498 <span class="comment">%writeSBML, findRxnsFromSubSystem under GNU General Public License v3.0,</span>
0499 <span class="comment">%license file in readme/GPL.MD. Code modified for RAVEN</span>
0500 modelSBML.groups_group.groups_kind = <span class="string">'partonomy'</span>;
0501 modelSBML.groups_group.sboTerm = 633;
0502 tmpStruct=modelSBML.groups_group;
0503 rxns=strcat(<span class="string">'R_'</span>,model.rxns);
0504 <span class="keyword">if</span> isfield(model, <span class="string">'subSystems'</span>)
0505     <span class="keyword">if</span> ~any(cellfun(@iscell,model.subSystems))
0506         subSystems = setdiff(model.subSystems,<span class="string">''</span>);
0507     <span class="keyword">else</span>
0508         orderedSubs = cellfun(@(x) <a href="#_sub4" class="code" title="subfunction vecT = columnVector(vec)">columnVector</a>(x),model.subSystems,<span class="string">'UniformOUtput'</span>,false);
0509         subSystems = setdiff(vertcat(orderedSubs{:}),<span class="string">''</span>);
0510     <span class="keyword">end</span>
0511     <span class="keyword">if</span> isempty(subSystems)
0512         subSystems = {};
0513     <span class="keyword">end</span>
0514     <span class="keyword">if</span> ~isempty(subSystems)
0515         <span class="comment">%Build the groups for the group package</span>
0516         groupIDs = strcat(<span class="string">'group'</span>,cellfun(@num2str, num2cell(1:length(subSystems))',<span class="string">'UniformOutput'</span>,false));
0517         <span class="keyword">for</span> i = 1:length(subSystems)
0518             cgroup = tmpStruct;
0519             <span class="keyword">if</span> ~any(cellfun(@iscell,model.subSystems))
0520                 present = ismember(model.subSystems,subSystems{i});
0521             <span class="keyword">else</span>
0522                 present = cellfun(@(x) any(ismember(x,subSystems{i})),model.subSystems);
0523             <span class="keyword">end</span>
0524             groupMembers = rxns(present);
0525             <span class="keyword">for</span> j = 1:numel(groupMembers)
0526                 cMember = tmpStruct.groups_member;
0527                 cMember.groups_idRef = groupMembers{j};
0528                 <span class="keyword">if</span> j == 1
0529                     cgroup.groups_member = cMember;
0530                 <span class="keyword">else</span>
0531                     cgroup.groups_member(j) = cMember;
0532                 <span class="keyword">end</span>
0533             <span class="keyword">end</span>
0534             cgroup.groups_id = groupIDs{i};
0535             cgroup.groups_name = subSystems{i};
0536             <span class="keyword">if</span> i == 1
0537                 modelSBML.groups_group = cgroup;
0538             <span class="keyword">else</span>
0539                 modelSBML.groups_group(i) = cgroup;
0540             <span class="keyword">end</span>
0541         <span class="keyword">end</span>
0542     <span class="keyword">end</span>
0543 <span class="keyword">end</span>
0544 
0545 <span class="comment">%Prepare fbc_objective subfield</span>
0546 
0547 modelSBML.fbc_objective.fbc_type=<span class="string">'maximize'</span>;
0548 modelSBML.fbc_objective.fbc_id=<span class="string">'obj'</span>;
0549 
0550 ind=find(model.c);
0551 
0552 <span class="keyword">if</span> isempty(ind)
0553     modelSBML.fbc_objective.fbc_fluxObjective.fbc_coefficient=0;
0554 <span class="keyword">else</span>
0555     <span class="keyword">for</span> i=1:length(ind)
0556         <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0557         <span class="comment">%last one</span>
0558         <span class="keyword">if</span> i&lt;numel(ind)
0559             modelSBML.reaction(i+1)=modelSBML.reaction(i);
0560         <span class="keyword">end</span>
0561         values=model.c(model.c~=0);
0562         modelSBML.fbc_objective(i).fbc_fluxObjective.fbc_reaction=modelSBML.reaction(ind(i)).id;
0563         modelSBML.fbc_objective(i).fbc_fluxObjective.fbc_coefficient=values(i);
0564         modelSBML.fbc_objective(i).fbc_fluxObjective.isSetfbc_coefficient=1;
0565     <span class="keyword">end</span>
0566 <span class="keyword">end</span>
0567 
0568 modelSBML.fbc_activeObjective=modelSBML.fbc_objective.fbc_id;
0569 
0570 fbcStr=[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/fbc/version'</span>,num2str(sbmlPackageVersions(1))];
0571 groupStr=[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/groups/version'</span>,num2str(sbmlPackageVersions(2))];
0572 modelSBML.namespaces=struct(<span class="string">'prefix'</span>,{<span class="string">''</span>,<span class="string">'fbc'</span>,<span class="string">'groups'</span>},<span class="keyword">...</span>
0573     <span class="string">'uri'</span>,{[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/core'</span>],<span class="keyword">...</span>
0574     fbcStr,groupStr});
0575 
0576 <span class="keyword">if</span> sbmlPackageVersions(1) == 2
0577     modelSBML.fbc_strict=1;
0578 <span class="keyword">end</span>
0579 
0580 OutputSBML(modelSBML,fileName,1,0,[1,0]);
0581 <span class="keyword">end</span>
0582 
0583 
0584 <a name="_sub1" href="#_subfunctions" class="code">function modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)</a>
0585 <span class="comment">%Returns the blank SBML model structure by using appropriate libSBML</span>
0586 <span class="comment">%functions. This creates structure by considering three levels</span>
0587 
0588 sbmlFieldNames=getStructureFieldnames(<span class="string">'model'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0589 sbmlDefaultValues=getDefaultValues(<span class="string">'model'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0590 
0591 <span class="keyword">for</span> i=1:numel(sbmlFieldNames)
0592     modelSBML.(sbmlFieldNames{1,i})=sbmlDefaultValues{1,i};
0593     sbmlSubfieldNames=getStructureFieldnames(sbmlFieldNames{1,i},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0594     sbmlSubfieldValues=getDefaultValues(sbmlFieldNames{1,i},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0595     <span class="keyword">if</span> ~strcmp(sbmlFieldNames{1,i},<span class="string">'event'</span>) &amp;&amp; ~strcmp(sbmlFieldNames{1,i},<span class="string">'functionDefinition'</span>) &amp;&amp; ~strcmp(sbmlFieldNames{1,i},<span class="string">'initialAssignment'</span>)
0596         <span class="keyword">for</span> j=1:numel(sbmlSubfieldNames)
0597             modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j})=sbmlSubfieldValues{1,j};
0598             sbmlSubsubfieldNames=getStructureFieldnames(sbmlSubfieldNames{1,j},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0599             sbmlSubsubfieldValues=getDefaultValues(sbmlSubfieldNames{1,j},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0600             <span class="keyword">if</span> ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'modifier'</span>) &amp;&amp; ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'kineticLaw'</span>)
0601                 <span class="keyword">for</span> k=1:numel(sbmlSubsubfieldNames)
0602                     <span class="comment">%'compartment' and 'species' fields are not supposed to</span>
0603                     <span class="comment">%have their standalone structures if they are subfields</span>
0604                     <span class="comment">%or subsubfields</span>
0605                     <span class="keyword">if</span> ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'compartment'</span>) &amp;&amp; ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'species'</span>)
0606                         modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j}).(sbmlSubsubfieldNames{1,k})=sbmlSubsubfieldValues{1,k};
0607                     <span class="keyword">end</span>
0608                     <span class="comment">%If it is fbc_association in the third level, we need</span>
0609                     <span class="comment">%to establish the fourth level, since libSBML requires</span>
0610                     <span class="comment">%it</span>
0611                     <span class="keyword">if</span> strcmp(sbmlSubsubfieldNames{1,k},<span class="string">'fbc_association'</span>)
0612                         fbc_associationFieldNames=getStructureFieldnames(<span class="string">'fbc_association'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0613                         fbc_associationFieldValues=getDefaultValues(<span class="string">'fbc_association'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0614                         <span class="keyword">for</span> l=1:numel(fbc_associationFieldNames)
0615                             modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j}).(sbmlSubsubfieldNames{1,k}).(fbc_associationFieldNames{1,l})=fbc_associationFieldValues{1,l};
0616                         <span class="keyword">end</span>
0617                     <span class="keyword">end</span>
0618                 <span class="keyword">end</span>
0619             <span class="keyword">end</span>
0620         <span class="keyword">end</span>
0621     <span class="keyword">end</span>
0622     <span class="keyword">if</span> ~isstruct(modelSBML.(sbmlFieldNames{1,i}))
0623         modelSBML.(sbmlFieldNames{1,i})=sbmlDefaultValues{1,i};
0624     <span class="keyword">end</span>
0625 <span class="keyword">end</span>
0626 
0627 modelSBML.unitDefinition.id=<span class="string">'mmol_per_gDW_per_hr'</span>;
0628 
0629 unitFieldNames=getStructureFieldnames(<span class="string">'unit'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0630 unitDefaultValues=getDefaultValues(<span class="string">'unit'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0631 
0632 kinds={<span class="string">'mole'</span>,<span class="string">'gram'</span>,<span class="string">'second'</span>};
0633 exponents=[1 -1 -1];
0634 scales=[-3 0 0];
0635 multipliers=[1 1 1*60*60];
0636 
0637 <span class="keyword">for</span> i=1:numel(unitFieldNames)
0638     modelSBML.unitDefinition.unit(1).(unitFieldNames{1,i})=unitDefaultValues{1,i};
0639     <span class="keyword">for</span> j=1:3
0640         modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=unitDefaultValues{1,i};
0641         <span class="keyword">if</span> strcmp(unitFieldNames{1,i},<span class="string">'kind'</span>)
0642             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=kinds{j};
0643         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'exponent'</span>)
0644             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=exponents(j);
0645         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'scale'</span>)
0646             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=scales(j);
0647         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'multiplier'</span>)
0648             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=multipliers(j);
0649         <span class="keyword">end</span>
0650     <span class="keyword">end</span>
0651 <span class="keyword">end</span>
0652 <span class="keyword">end</span>
0653 
0654 <a name="_sub2" href="#_subfunctions" class="code">function miriamString=getMiriam(miriamStruct)</a>
0655 <span class="comment">%Returns a string with list elements for a miriam structure ('&lt;rdf:li</span>
0656 <span class="comment">%rdf:resource=&quot;http://identifiers.org/go/GO:0005739&quot;/&gt;' for example). This</span>
0657 <span class="comment">%is just to speed up things since this is done many times during the</span>
0658 <span class="comment">%exporting</span>
0659 
0660 miriamString=<span class="string">''</span>;
0661 <span class="keyword">if</span> isfield(miriamStruct,<span class="string">'name'</span>)
0662     <span class="keyword">for</span> i=1:numel(miriamStruct.name)
0663         miriamString=[miriamString <span class="string">'&lt;rdf:li rdf:resource=&quot;http://identifiers.org/'</span> miriamStruct.name{i} <span class="string">'/'</span> miriamStruct.value{i} <span class="string">'&quot;/&gt;'</span>];
0664     <span class="keyword">end</span>
0665 <span class="keyword">end</span>
0666 <span class="keyword">end</span>
0667 
0668 <a name="_sub3" href="#_subfunctions" class="code">function [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)</a>
0669 <span class="comment">%This function provides reactants and products for particular reaction. The</span>
0670 <span class="comment">%function was 'borrowed' from writeSBML in COBRA toolbox, lines 663-679</span>
0671 
0672 met_idx = find(model.S(:, i));
0673 tmp_Rxn.product=[];
0674 tmp_Rxn.reactant=[];
0675 <span class="keyword">for</span> j_met=1:size(met_idx,1)
0676     tmp_idx = met_idx(j_met,1);
0677     sbml_tmp_species_ref.species = sbmlModel.species(tmp_idx).id;
0678     met_stoich = model.S(tmp_idx, i);
0679     sbml_tmp_species_ref.stoichiometry = abs(met_stoich);
0680     sbml_tmp_species_ref.isSetStoichiometry=1;
0681     sbml_tmp_species_ref.constant=1;
0682     <span class="keyword">if</span> (met_stoich &gt; 0)
0683         tmp_Rxn.product = [ tmp_Rxn.product, sbml_tmp_species_ref ];
0684     <span class="keyword">else</span>
0685         tmp_Rxn.reactant = [ tmp_Rxn.reactant, sbml_tmp_species_ref];
0686     <span class="keyword">end</span>
0687 <span class="keyword">end</span>
0688 <span class="keyword">end</span>
0689 
0690 <a name="_sub4" href="#_subfunctions" class="code">function vecT = columnVector(vec)</a>
0691 <span class="comment">% Code below taken from COBRA Toolbox under GNU General Public License v3.0</span>
0692 <span class="comment">% license file in readme/GPL.MD.</span>
0693 <span class="comment">%</span>
0694 <span class="comment">% Converts a vector to a column vector</span>
0695 <span class="comment">%</span>
0696 <span class="comment">% USAGE:</span>
0697 <span class="comment">%</span>
0698 <span class="comment">%   vecT = columnVector(vec)</span>
0699 <span class="comment">%</span>
0700 <span class="comment">% INPUT:</span>
0701 <span class="comment">%   vec:     a vector</span>
0702 <span class="comment">%</span>
0703 <span class="comment">% OUTPUT:</span>
0704 <span class="comment">%   vecT:    a column vector</span>
0705 <span class="comment">%</span>
0706 <span class="comment">% .. Authors:</span>
0707 <span class="comment">%     - Original file: Markus Herrgard - Minor changes: Laurent Heirendt</span>
0708 <span class="comment">%     January 2017</span>
0709 
0710 [n, m] = size(vec);
0711 
0712 <span class="keyword">if</span> n &lt; m
0713     vecT = vec';
0714 <span class="keyword">else</span>
0715     vecT = vec;
0716 <span class="keyword">end</span>
0717 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 07-May-2018 14:25:05 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>