<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of tutorial3_solutions</title>
  <meta name="keywords" content="tutorial3_solutions">
  <meta name="description" content="This contains the code necessary for running Exercises 3. It is assumed">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">tutorial</a> &gt; tutorial3_solutions.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for tutorial&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>tutorial3_solutions
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This contains the code necessary for running Exercises 3. It is assumed</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">This contains the code necessary for running Exercises 3. It is assumed
that you are somewhat familiar with linear programming.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../core/addRxns.html" class="code" title="function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets)">addRxns</a>	addRxns</li><li><a href="../core/canConsume.html" class="code" title="function consumed=canConsume(model,mets)">canConsume</a>	canConsume</li><li><a href="../core/changeRxns.html" class="code" title="function model=changeRxns(model,rxns,equations,eqnType,compartment,allowNewMets)">changeRxns</a>	changeRxns</li><li><a href="../core/checkProduction.html" class="code" title="function [notProduced, notProducedNames, neededForProductionMat,minToConnect,model]=checkProduction(model,checkNeededForProduction,excretionFromCompartments,printDetails)">checkProduction</a>	checkProduction</li><li><a href="../core/constructEquations.html" class="code" title="function equationStrings=constructEquations(model,rxns,useComps,sortRevRxns,sortMetNames)">constructEquations</a>	constructEquations</li><li><a href="../core/fillGaps.html" class="code" title="function [newConnected cannotConnect addedRxns newModel exitFlag]=fillGaps(model,models,allowNetProduction,useModelConstraints,supressWarnings,rxnScores,params)">fillGaps</a>	fillGaps</li><li><a href="../core/gapReport.html" class="code" title="function [noFluxRxns, noFluxRxnsRelaxed, subGraphs, notProducedMets, minToConnect,neededForProductionMat, canProduceWithoutInput, canConsumeWithoutOutput,connectedFromTemplates, addedFromTemplates]=gapReport(model, templateModels)">gapReport</a>	gapReport</li><li><a href="../core/getExchangeRxns.html" class="code" title="function [exchangeRxns, exchangeRxnsIndexes]=getExchangeRxns(model,reactionType)">getExchangeRxns</a>	getExchangeRxns</li><li><a href="../core/printFluxes.html" class="code" title="function printFluxes(model, fluxes, onlyExchange, cutOffFlux, outputFile,outputString,metaboliteList)">printFluxes</a>	printFluxes</li><li><a href="../core/removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>	removeMets</li><li><a href="../core/setParam.html" class="code" title="function model=setParam(model, paramType, rxnList, params)">setParam</a>	setParam</li><li><a href="../core/simplifyModel.html" class="code" title="function [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,deleteUnconstrained, deleteDuplicates, deleteZeroInterval, deleteInaccessible, deleteMinMax, groupLinear, reservedRxns, suppressWarnings)">simplifyModel</a>	simplifyModel</li><li><a href="../io/importExcelModel.html" class="code" title="function model=importExcelModel(fileName,removeExcMets,printWarnings,ignoreErrors)">importExcelModel</a>	importExcelModel</li><li><a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>	solveLP</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%This contains the code necessary for running Exercises 3. It is assumed</span>
0002 <span class="comment">%that you are somewhat familiar with linear programming.</span>
0003 
0004 <span class="comment">%NOTE: Many of these changes are easier to do in the Excel sheet. They are</span>
0005 <span class="comment">%done here in code just to avoid having several model files.</span>
0006 
0007 <span class="comment">%Load the model</span>
0008 model=<a href="../io/importExcelModel.html" class="code" title="function model=importExcelModel(fileName,removeExcMets,printWarnings,ignoreErrors)">importExcelModel</a>(<span class="string">'smallYeastBad.xlsx'</span>);
0009 
0010 <span class="comment">%Close all uptake and maximize for production</span>
0011 model=<a href="../core/setParam.html" class="code" title="function model=setParam(model, paramType, rxnList, params)">setParam</a>(model,<span class="string">'eq'</span>,{<span class="string">'glcIN'</span>, <span class="string">'o2IN'</span>},[0 0]);
0012 model=<a href="../core/setParam.html" class="code" title="function model=setParam(model, paramType, rxnList, params)">setParam</a>(model,<span class="string">'obj'</span>,{<span class="string">'acOUT'</span> <span class="string">'biomassOUT'</span> <span class="string">'co2OUT'</span> <span class="string">'ethOUT'</span> <span class="string">'glyOUT'</span>},[1 1 1 1 1]);
0013 sol=<a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model);
0014 <a href="../core/printFluxes.html" class="code" title="function printFluxes(model, fluxes, onlyExchange, cutOffFlux, outputFile,outputString,metaboliteList)">printFluxes</a>(model,sol.x,true); <span class="comment">%Nothing produced, good</span>
0015 
0016 <span class="comment">%Add some fake reactions</span>
0017 rxns.rxns={<span class="string">'FREE_ATP'</span>;<span class="string">'FREE_NADH'</span>;<span class="string">'FREE_NADPH'</span>};
0018 rxns.equations={<span class="string">'ATP &lt;=&gt; ADP + phosphate'</span>;<span class="string">'NAD(+) &lt;=&gt; NADH'</span>;<span class="string">'NADP(+) &lt;=&gt; NADPH'</span>};
0019 model=<a href="../core/addRxns.html" class="code" title="function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets)">addRxns</a>(model,rxns,2,<span class="string">'c'</span>);
0020 sol=<a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model,1);
0021 <span class="comment">%Lots of ethanol produced.We also plot the equations to make the error easier to find</span>
0022 <a href="../core/printFluxes.html" class="code" title="function printFluxes(model, fluxes, onlyExchange, cutOffFlux, outputFile,outputString,metaboliteList)">printFluxes</a>(model,sol.x,false,[],[],<span class="string">'%rxnID (%rxnName):%flux\n\t%eqn\n'</span>);
0023 
0024 <span class="comment">%You will see that ADH1 should only produce one unit of ethanol. Change the</span>
0025 <span class="comment">%reaction equation</span>
0026 model=<a href="../core/changeRxns.html" class="code" title="function model=changeRxns(model,rxns,equations,eqnType,compartment,allowNewMets)">changeRxns</a>(model,<span class="string">'ADH1'</span>,<span class="string">'acetaldehyde[c] + NADH[c] =&gt; ethanol[c] + NAD(+)[c]'</span>,3);
0027 sol=<a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model,1);
0028 <a href="../core/printFluxes.html" class="code" title="function printFluxes(model, fluxes, onlyExchange, cutOffFlux, outputFile,outputString,metaboliteList)">printFluxes</a>(model,sol.x,true); <span class="comment">%Nothing produced, good</span>
0029 
0030 <span class="comment">%Add excretion of all metabolites</span>
0031 model.b=[model.b inf(numel(model.b),1)];
0032 sol=<a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model,1);
0033 <a href="../core/printFluxes.html" class="code" title="function printFluxes(model, fluxes, onlyExchange, cutOffFlux, outputFile,outputString,metaboliteList)">printFluxes</a>(model,sol.x,false,10^-5,[],<span class="string">'%rxnID (%rxnName):\n\t%eqn\n\t%flux\n'</span>);
0034 
0035 <span class="comment">%By looking at the reactions which were unbalanced and that were in the</span>
0036 <span class="comment">%flux list we can see that FBP should be changed to result in only one unit</span>
0037 <span class="comment">%of F6P</span>
0038 model=<a href="../core/changeRxns.html" class="code" title="function model=changeRxns(model,rxns,equations,eqnType,compartment,allowNewMets)">changeRxns</a>(model,<span class="string">'FBP'</span>,<span class="string">'beta-D-fructofuranose 1,6-bisphosphate[c] =&gt; beta-D-fructofuranose 6-phosphate[c] + phosphate[c]'</span>,3);
0039 sol=<a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model,1);
0040 <a href="../core/printFluxes.html" class="code" title="function printFluxes(model, fluxes, onlyExchange, cutOffFlux, outputFile,outputString,metaboliteList)">printFluxes</a>(model,sol.x,false,10^-5,[],<span class="string">'%rxnID (%rxnName):\n\t%eqn\n\t%flux\n'</span>);
0041 <span class="comment">%The same thing again and we should change PFK to only give one unit of</span>
0042 <span class="comment">%F16P</span>
0043 model=<a href="../core/changeRxns.html" class="code" title="function model=changeRxns(model,rxns,equations,eqnType,compartment,allowNewMets)">changeRxns</a>(model,<span class="string">'PFK'</span>,<span class="string">'ATP[c] + beta-D-fructofuranose 6-phosphate[c] =&gt; ADP[c] + beta-D-fructofuranose 1,6-bisphosphate[c]'</span>,3);
0044 sol=<a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model,1);
0045 <a href="../core/printFluxes.html" class="code" title="function printFluxes(model, fluxes, onlyExchange, cutOffFlux, outputFile,outputString,metaboliteList)">printFluxes</a>(model,sol.x,false,10^-5,[],<span class="string">'%rxnID (%rxnName):\n\t%eqn\n\t%flux\n'</span>); <span class="comment">%Now it works</span>
0046 
0047 <span class="comment">%Set all uptakes and production to 0</span>
0048 model=<a href="../core/setParam.html" class="code" title="function model=setParam(model, paramType, rxnList, params)">setParam</a>(model,<span class="string">'eq'</span>,<a href="../core/getExchangeRxns.html" class="code" title="function [exchangeRxns, exchangeRxnsIndexes]=getExchangeRxns(model,reactionType)">getExchangeRxns</a>(model),0);
0049 
0050 <span class="comment">%Since we're checking for which metabolites could be consumed without</span>
0051 <span class="comment">%production, we can no longer have free production of all metabolites.</span>
0052 model.b=model.b(:,1);
0053 I=<a href="../core/canConsume.html" class="code" title="function consumed=canConsume(model,mets)">canConsume</a>(model);
0054 model.mets(I) <span class="comment">%These 12 metabolites can be consumed without any production</span>
0055 
0056 <span class="comment">%Allow all uptake</span>
0057 model.b=[ones(numel(model.b),1)*-1000 model.b];
0058 
0059 <span class="comment">%We pick CO2 and force uptake of it</span>
0060 model=<a href="../core/setParam.html" class="code" title="function model=setParam(model, paramType, rxnList, params)">setParam</a>(model,<span class="string">'eq'</span>,{<span class="string">'co2OUT'</span>},-1); <span class="comment">%Negative output means input</span>
0061 sol=<a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model);
0062 <a href="../core/printFluxes.html" class="code" title="function printFluxes(model, fluxes, onlyExchange, cutOffFlux, outputFile,outputString,metaboliteList)">printFluxes</a>(model,sol.x,false,10^-5,[],<span class="string">'%rxnID (%rxnName):\n\t%eqn\n\t%flux\n'</span>); <span class="comment">%Now it works</span>
0063 <span class="comment">%We see that PDC converts pyruvate (3 carbons) to acetaldehyde(2 carbons)</span>
0064 <span class="comment">%without any other products. If we google we realize that CO2 is missing.</span>
0065 <span class="comment">%This would be simpler to change in the Excel file (or using changeRxns),</span>
0066 <span class="comment">%but lets change it here as an exercise. We need to find the index of the</span>
0067 <span class="comment">%reactions and the index of cytosolic CO2 in order to change the reaction</span>
0068 Irxn=ismember(model.rxns,<span class="string">'PDC'</span>);
0069 Imet=ismember(model.mets,<span class="string">'CO2_c'</span>);
0070 model.S(Imet,Irxn)=1; <span class="comment">%The coefficient is 1.0</span>
0071 
0072 <span class="comment">%Display the new equation just to be sure</span>
0073 <a href="../core/constructEquations.html" class="code" title="function equationStrings=constructEquations(model,rxns,useComps,sortRevRxns,sortMetNames)">constructEquations</a>(model,Irxn)
0074 
0075 <span class="comment">%The solution is now not feasible, meaning that it's no longer possible to</span>
0076 <span class="comment">%force uptake of CO2 without any output</span>
0077 sol=<a href="../solver/solveLP.html" class="code" title="function [solution hsSolOut prob]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model)
0078 
0079 <span class="comment">%***Second part of tutorial</span>
0080 model=<a href="../io/importExcelModel.html" class="code" title="function model=importExcelModel(fileName,removeExcMets,printWarnings,ignoreErrors)">importExcelModel</a>(<span class="string">'smallYeastBad2.xlsx'</span>,true,false,true); <span class="comment">%This has to be loaded with the setting to ignore error or it would find the error for you :)</span>
0081 [reducedModel, deletedReactions, deletedMetabolites]=<a href="../core/simplifyModel.html" class="code" title="function [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,deleteUnconstrained, deleteDuplicates, deleteZeroInterval, deleteInaccessible, deleteMinMax, groupLinear, reservedRxns, suppressWarnings)">simplifyModel</a>(model,false,false,false,true);
0082 deletedReactions
0083 deletedMetabolites
0084 
0085 <span class="comment">%It turned out that G15L_c was spelled G15Lc in one reaction. The best</span>
0086 <span class="comment">%solution would be just to change it in the reaction list and remove the</span>
0087 <span class="comment">%duplicate metabolite, but we can do it here as an exercise. We need the</span>
0088 <span class="comment">%indexes of the two metabolites</span>
0089 Igood=ismember(model.mets,<span class="string">'G15L_c'</span>);
0090 Ibad=ismember(model.mets,<span class="string">'G15Lc'</span>);
0091 
0092 <span class="comment">%Then get all reactions and the coefficients in which the wrong one participates</span>
0093 <span class="comment">%move them to be for the right one instead</span>
0094 model.S(Igood,:)=model.S(Igood,:)+model.S(Ibad,:);
0095 
0096 <span class="comment">%Then delete the bad one</span>
0097 model=<a href="../core/removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>(model,<span class="string">'G15Lc'</span>);
0098 [reducedModel, deletedReactions, deletedMetabolites]=<a href="../core/simplifyModel.html" class="code" title="function [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,deleteUnconstrained, deleteDuplicates, deleteZeroInterval, deleteInaccessible, deleteMinMax, groupLinear, reservedRxns, suppressWarnings)">simplifyModel</a>(model,false,false,false,true);
0099 deletedReactions
0100 deletedMetabolites
0101 
0102 <span class="comment">%The only difference was that we had 20 deleted metabolites instead of 21.</span>
0103 <span class="comment">%Nothing too spectacular. Check production can tell us what we need to</span>
0104 <span class="comment">%connect.</span>
0105 [notProducedMets, crap, neededForProductionMat,minToConnect]=<a href="../core/checkProduction.html" class="code" title="function [notProduced, notProducedNames, neededForProductionMat,minToConnect,model]=checkProduction(model,checkNeededForProduction,excretionFromCompartments,printDetails)">checkProduction</a>(model,true,model.comps,false);
0106 
0107 <span class="comment">%In order to have production of all 54 metabolites we need to enable</span>
0108 <span class="comment">%production of these 12. This small model does not include net synthesis of</span>
0109 <span class="comment">%co-factors, so let's concentrate on the other ones. Glycerone phosphate</span>
0110 <span class="comment">%allows for connection 18 others, so it seems like a good target.</span>
0111 minToConnect
0112 
0113 <span class="comment">%If you google around a little bit, and know your metabolism, you would</span>
0114 <span class="comment">%find that DHAP (dihydroxyacetone) and GLYP (glycerone phosphate) are</span>
0115 <span class="comment">%actually synonymes. Lets only use DHAP</span>
0116 Igood=ismember(model.mets,<span class="string">'DHAP_c'</span>);
0117 Ibad=ismember(model.mets,<span class="string">'GLYP_c'</span>);
0118 
0119 <span class="comment">%Then get all reactions and the coefficients in which the wrong one participates</span>
0120 <span class="comment">%move them to be for the right one instead</span>
0121 model.S(Igood,:)=model.S(Igood,:)+model.S(Ibad,:);
0122 
0123 <span class="comment">%Then delete the bad one</span>
0124 model=<a href="../core/removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>(model,<span class="string">'GLYP_c'</span>);
0125 [reducedModel, deletedReactions, deletedMetabolites]=<a href="../core/simplifyModel.html" class="code" title="function [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,deleteUnconstrained, deleteDuplicates, deleteZeroInterval, deleteInaccessible, deleteMinMax, groupLinear, reservedRxns, suppressWarnings)">simplifyModel</a>(model,false,false,false,true);
0126 deletedReactions
0127 deletedMetabolites
0128 [notProducedMets, crap, neededForProductionMat,minToConnect]=<a href="../core/checkProduction.html" class="code" title="function [notProduced, notProducedNames, neededForProductionMat,minToConnect,model]=checkProduction(model,checkNeededForProduction,excretionFromCompartments,printDetails)">checkProduction</a>(model,true,model.comps,false);
0129 minToConnect
0130 
0131 <span class="comment">%Still quite a lot of gaps and no immediate way to fix it. We could try</span>
0132 <span class="comment">%including reactions from a reference network and see if that helps. Let's</span>
0133 <span class="comment">%use the small yeast model from tutorial 2</span>
0134 refModel=<a href="../io/importExcelModel.html" class="code" title="function model=importExcelModel(fileName,removeExcMets,printWarnings,ignoreErrors)">importExcelModel</a>(<span class="string">'smallYeast.xlsx'</span>);
0135 [newConnected cannotConnect addedRxns newModel]=<a href="../core/fillGaps.html" class="code" title="function [newConnected cannotConnect addedRxns newModel exitFlag]=fillGaps(model,models,allowNetProduction,useModelConstraints,supressWarnings,rxnScores,params)">fillGaps</a>(model,{refModel},false);
0136 addedRxns
0137 newConnected
0138 
0139 <span class="comment">%By including the ALD6 reaction from the reference model we were able to</span>
0140 <span class="comment">%connect 21 reactions!</span>
0141 [reducedModel, deletedReactions, deletedMetabolites]=<a href="../core/simplifyModel.html" class="code" title="function [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,deleteUnconstrained, deleteDuplicates, deleteZeroInterval, deleteInaccessible, deleteMinMax, groupLinear, reservedRxns, suppressWarnings)">simplifyModel</a>(newModel,false,false,false,true);
0142 deletedMetabolites
0143 deletedReactions
0144 
0145 <span class="comment">%TADA! All the model seems to be connected</span>
0146 
0147 <span class="comment">%All this stuff could be done in a more automated manner as well</span>
0148 model=<a href="../io/importExcelModel.html" class="code" title="function model=importExcelModel(fileName,removeExcMets,printWarnings,ignoreErrors)">importExcelModel</a>(<span class="string">'smallYeastBad2.xlsx'</span>,true,false,true);
0149 <a href="../core/gapReport.html" class="code" title="function [noFluxRxns, noFluxRxnsRelaxed, subGraphs, notProducedMets, minToConnect,neededForProductionMat, canProduceWithoutInput, canConsumeWithoutOutput,connectedFromTemplates, addedFromTemplates]=gapReport(model, templateModels)">gapReport</a>(model,{refModel});</pre></div>
<hr><address>Generated on Fri 14-Oct-2016 12:02:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>